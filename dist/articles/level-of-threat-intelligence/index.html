<!DOCTYPE html><html data-n-head="" data-n-head-ssr><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="Nuxt.js project" name="description" data-hid="description"><title data-n-head="true">360威胁情报中心</title><link href="/fav.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="/_nuxt/manifest.cc16cbbf77dfa41bad8e.js" rel="preload" as="script"><link href="/_nuxt/vendor.bundle.45eca4dc7fa9e1bc4361.js" rel="preload" as="script"><link href="/_nuxt/nuxt.bundle.8e9d53f64bed77ebfe81.js" rel="preload" as="script"><link href="/_nuxt/0.nuxt.bundle.80f81277e0b6c2560f13.js" rel="prefetch"><link href="/_nuxt/1.nuxt.bundle.cf573f78a75ebea612ec.js" rel="prefetch"><link href="/_nuxt/2.nuxt.bundle.8dec8f94589066ca73ff.js" rel="prefetch"><link href="/_nuxt/3.nuxt.bundle.6fe3201bb9c53fc87aae.js" rel="prefetch"><link href="/_nuxt/4.nuxt.bundle.e235b3a9f818c5cd93cb.js" rel="prefetch"><link href="/_nuxt/5.nuxt.bundle.099a834914406ac2b809.js" rel="prefetch"><style data-vue-ssr-id="1cbf7f39:0 198c0e1e:0 034fd8e0:0 ba3a09e0:0 c2ba7178:0 01cb4693:0 69b5e360:0">.progress[data-v-862bdd9c]{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;-o-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}.hljs ::-webkit-scrollbar{width:8px;height:10px;border-radius:2px;background-color:#839496}.hljs ::-webkit-scrollbar-track{background-color:#bebebe}.hljs ::-webkit-scrollbar-thumb,.hljs ::-webkit-scrollbar-track{border-radius:2px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3)}.hljs ::-webkit-scrollbar-thumb{background-color:#789}html{font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box}body{background-color:rgba(66,66,66,.05)}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;text-decoration:none}a:active,a:hover,a:link,a:visited{color:#0b1802}.main-body h1,.main-body h2,.main-body h3,.main-body h4,.main-body h5,.main-body h6{margin-top:0;margin-bottom:.5rem}.main-body p{margin-top:0;margin-bottom:1rem;font-size:15px;text-indent:25px;word-wrap:break-word}.main-body img{vertical-align:middle;border-style:none;margin:auto 20px auto auto;padding:3px;border-radius:3px;background-color:#e6e6d5;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.15);box-shadow:0 1px 2px rgba(0,0,0,.15);border:1px solid #b9baa6}.main-body .text-center{text-align:center!important}.main-body table{border-collapse:collapse!important;width:100%;max-width:100%;margin:1em 0;background-color:transparent}.main-body table tbody+tbody{border-top:2px solid #e9ecef}.main-body table td,.main-body table th{padding:.5rem;font-size:.95em;text-align:center;border-collapse:collapse}.main-body table tr{border:1px solid #dfe8fe}.main-body table tr:nth-child(odd){background-color:#ecf1fe}.main-body table tr:nth-child(2n){background-color:#fdfdfd}.main-body table td{white-space:normal;word-break:break-all}.main-body code,.main-body kbd,.main-body pre,.main-body samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.nav-bar[data-v-42857612]{height:60px;border-bottom:1px solid #d5d5d5}.nav-bar .ico-favicon[data-v-42857612]{height:28px;margin-top:16px;margin-left:108px;cursor:pointer}.nav-bar .ico-home[data-v-42857612]{display:inline-block;margin:16px;float:right}.disPic .pic[data-v-42857612]{background-color:#faa732;height:480px;width:100%}.article-page[data-v-8db87e62]{margin:0 auto;max-width:1108px;background-size:cover}.article-page .page-header[data-v-8db87e62]{border-bottom:1px solid #efefef}.article-page .page-header .ava img[data-v-8db87e62]{border-radius:50%;height:56px;width:56px;float:left;margin:12px}.article-page .page-header .title[data-v-8db87e62]{font-size:48px;color:#0b1802;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'"}.article-page .page-header .author[data-v-8db87e62]{display:inline-block;color:#979996;font-size:16px;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'";margin:12px 7px 12px 0;line-height:16px}.article-page .page-header .author .ico-time img[data-v-8db87e62]{width:16px;height:16px}.article-page .main-body[data-v-8db87e62]{padding:0 108px;margin:28px auto 168px;background:url(/_nuxt/img/post-entry-bg.98216ca.png) no-repeat -10px 9px}.title-home[data-v-552f8598]{font-family:sans-serif;line-height:32px;font-size:24px;color:#0b1802;cursor:pointer;max-height:32px;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.title-home[data-v-552f8598]:hover{text-shadow:2px 3px 1px #d0d0d0}.title-detail[data-v-552f8598]{font-size:48px;color:#0b1802;font-family:Arial Rounded MT Bold;margin-top:48px;line-height:64px}@media screen and (min-width:550px) and (max-width:950px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}@media screen and (max-width:550px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}.tags[data-v-53a17526]{height:42px;padding-top:10px}.tag[data-v-53a17526]{background-color:#6aacd8;display:inline-block;height:22px;font-size:13px;color:#fefefe;font-family:sans-serif;padding:2px 6px;margin-right:8px;border-radius:2px}</style><body data-n-head=""><div data-server-rendered="true" id="__nuxt"><div class="progress" data-v-862bdd9c style="width:0%;height:2px;background-color:#3b8070;opacity:0"></div><div><section><div data-v-42857612><div class="nav-bar" data-v-42857612><a href="/" data-v-42857612><img src="/_nuxt/img/blog-icon.f80549d.png" class="ico-favicon" data-v-42857612></a><a href="/" data-v-42857612><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABYklEQVRYR+2Vy1HDMBCGV5sG0oLH3EkHkA78CHUAHdABtMCZyHEHdgnmHo8pIQ1kxcgTh+DRY20fAjPWTaOV/s//PizgyktcWR9mgP/rQLRrlkj0qGuIEN/zOPgaU0+jHIh2zQqJCgGw1KIK4ECI6zwOqqEQgwH64p3gWIhBADbxKRBsgFPOm852m9VDnWABaPHFkQoQsOLk+AQR5HFw8MV7AYaKnwUVVMdFW5hOCCfAaPGfovBCWAEmizMhrACJrCsBcOvLIevckQ4jQCLrJwHwynqcGaQAnrM0fOuH/00ATbn5aO7bMYtUMD/SGCYI1/pg+xCUpgBvG6ayVqaLCuATQJ1bTIC4M8XJNHRqjAboP2wDnQFmByY7kMh9aapwThHqTsnS0PkH9XfBdh+BELt+i3EAQKlYbm5y1xzxAnRDiZDawdStLA1fLveJrH/tkbC0DZ/LeyyAKZPQd3cGmB34BjX7xSHXvTXWAAAAAElFTkSuQmCC" class="ico-home" data-v-42857612></a></div><!----></div><div class="article-page" data-v-8db87e62><div class="page-header" data-v-8db87e62><div class="title-detail" data-v-552f8598 data-v-8db87e62>威胁情报的层次分析</div><div class="ava" data-v-8db87e62><img data-v-8db87e62></div><div class="tags" data-v-53a17526 data-v-8db87e62></div><div class="author lh32" data-v-8db87e62>汪列军 on</div></div><div class="main-body" data-v-8db87e62><h2 class="line" data-line="0">威胁情报的层次分析</h2><p class="line" data-line="2">威胁情报，近几年来兴起的安全热点，已经从理念到技术再到平台逐步开始落地。不管是老牌的安全公司还是新兴的厂商都正在这方面探索，包括可行的技术方案、交换标准及商业模式。本文着重为读者介绍一下我所理解的威胁情报的层次，结合自身的实践，提出了一个金字塔模型，希望有助于提升业界对威胁情报的认识。<h3 class="line" data-line="4">威胁情报的概念</h3><p class="line" data-line="6">目前，Gartner对于威胁情报的定义比较广地被引用：<p class="line" data-line="8">“Threat intelligence is evidence-based knowledge, including context, mechanisms, indicators, implications and actionable advice, about an existing or emerging menace or hazard to assets that can be used to inform decisions regarding the subject's response to that menace or hazard.”<p class="line" data-line="10">这是一个比较理想化的定义，对情报应该包含的信息量提出了明确的要求，面向高端用户提供决策依据的完整情报样式，可以认为是狭义的威胁情报。<p class="line" data-line="12">事实上，对于大多数的组织机构得不到上述这类准确和全面的情报服务，即便得到也无法采取应对措施。想象一下，即使有安全厂商能够告诉某个大公司一个安全威胁的背后的组织、国家背景甚至人员信息（这些都是高端威胁情报的必要组成部分），那又能如何？通常的组织机构不是执法机构，无法对这些情报采取什么缓解威胁的措施。<p class="line" data-line="14">对一般的公司组织相对低端的入侵指示器（Indicator Of Compromise，IOC）可能更为实际些，它由可被边界安全设备和主机安全防护软件所使用的数据所构成，典型的入侵指示器有文件HASH、IP、域名、程序运行路径、注册表项等，这类威胁情报在下文有详细的分析。<h3 class="line" data-line="16">威胁情报的作用</h3><p class="line" data-line="18">通过对威胁情报的交换和共享，联合安全业界各方的力量，整合信息资源实现更大范围内的快速响应，以对抗也在不停进化的安全威胁。以下Webroot小纪念品上的图非常形象地表现了威胁情报所能起到的作用。<p class="text-center line" data-line="20"><img src="/uploads/2017/07/25/869d3df44a6f8ecd3f9a9a262fb10259.png" alt=""><p class="line" data-line="22">目前威胁情报作为一个安全关键词显得非常火热，但是显然被有些寄予了过高的期望，在安全领域不存在什么单点的银弹技术。准确及时的入侵指示数据可以帮助用户快速处理已经或正在发生的威胁，比如黑样本的HASH、对外连接的CC及Downloader服务器的IP或域名，网络边界设备或运行于主机上的Agent可以通过简单的匹配就能发现并采用自动化的应对措施。当用户试图分析一个可疑事件时，威胁情报可以为用户判定可疑事件的恶意性提供有用的参考资料，比如事件所涉及到的IP是否在某些已知的黑名单之中，相关的域名是否被已知的APT活动使用等。<h3 class="line" data-line="24">威胁情报的层次</h3><p class="text-center line" data-line="26"><img src="/uploads/2017/07/25/bc5008dcf0f163de8a317d8befd5eded.png" alt="" width="45%"><p class="line" data-line="28">上图是我们构建的一个展示威胁情报层次的金字塔图，我们从下到上逐层解释一下每个层次的信息构成，所能发挥的作用及分析获取的方法。<h4 class="line" data-line="30">文件HASH</h4><p class="line" data-line="32">最底层威胁情报由文件构成，主要涉及恶意网络活动相关的各种恶意代码：Trojan、Backdoor、Downloader、Dropper等。一般来说，文件样本是整个事件分析的起点和基础性数据，其重要性相当于刑事案件调查中最主要的物证，比如凶器和尸体。用于标记文件的各种HASH是最基本威胁情报信息，可以方便地用于在目标系统上进行搜索，如果一个木马文件在系统上被发现则对象被感染的可能性就非常大。下图是Symantec发布的Butterfly攻击活动相关的部分文件HASH列表。<p class="text-center line" data-line="34"><img src="/uploads/2017/07/25/797ed870122992cd8f261a4ff69eb6c9.png" alt="" width="90%"><p class="line" data-line="36">绝大多数文件HASH的主要问题在于特异性太强，无论是MD5、SHA1、SHA256，只要文件出现一个比特位的变化就会导致完全不同的HASH值，这个特性在避免误报的同时也使攻击者可以通过最简单的内容修改来躲过检测，所以一旦被公开揭露，几乎立即过期。因此，文件HASH作为入侵指示器基本只能用来发现已发生的事件，对防御方来说需要用自动化的搜索匹配机制尽可能用其来缩短从事件发生到发现时间窗口，以尽可能减少损失。<h4 class="line" data-line="38">主机和网络特征</h4><p class="line" data-line="40">在文件HASH之上的是通过分析文件样本得到的直接关联的各类基于主机和网络特征，这些数据可以被用来作为入侵指示器。简单来说，主机特征可能包含恶意代码在机器上运行时产生的有区分能力的数据，比如程序运行时的Mutex、写入的注册表项、文件路径等，网络特征可能包含对外连接的C&C或组件下载的IP/域名、访问的URL、通信协议等信息。下图是一个木马内置的主机与网络特征数据的例子。<p class="text-center line" data-line="42"><img src="/uploads/2017/07/25/0952d915d9506860b3a4f8784debdacd.png" alt="" width="90%"><p class="line" data-line="44">这些数据大多可以通过使样本运行于受控环境（沙箱和虚拟机）来获取，对于对抗强度较高的或无法运行的样本手工的逆向调试分析则有可能是必须的，这时就需要很大的时间与精力投入。相较于文件HASH，这些从文件中通过静态或动态分析得到的特征相对稳定，但改变的代价依然很小，特别是在被公开揭露出来以后，作为入侵指示器的价值也会很快消失。<h4 class="line" data-line="46">事件层次情报</h4><p class="line" data-line="48">在单个样本相关的信息以上为事件层次的威胁情报。当我们得到了大量文件样本相关的细节以后，通过分析其各个维度上的相似度就可以实现样本家族的分类。下图是三个疑似欧洲来源的秘密监控软件基于样本特征的同源性分析，可以看到一些关键特征保持一致，暗示它们有共同的源头。<p class="text-center line" data-line="50"><img src="/uploads/2017/07/25/fd9f10aa52b4ba6c312ceb500b0cd377.png" alt="" width="90%"><p class="line" data-line="52">通过分析样本之间的上下游关系，可以推断攻击发生时恶意代码的进入渠道，从而了解对手的攻击手法，通过鱼叉邮件、水坑攻击、U盘植入还是其他主动性的攻击，是否利用了安全漏洞，使用了什么样的社工技巧。了解攻击的方法对于防御方调整防护方案，填补漏洞和盲点，使防护更有针对性同时降低成本有重要的意义。下图是2015年360公司揭露的海莲花APT事件中攻击者所使用的恶意代码感染方式。<p class="text-center line" data-line="54"><img src="/uploads/2017/07/25/9327cd893ec3f6e366e17d5e7448a629.png" alt="" width="90%"><p class="line" data-line="56">如果收集到的数据包含受害者内部网络和主机的行为，我们还能了解攻击者在受害者内部系统中尝试进一步获取控制的方式和方法。因此，要得到的准确的事件层次的威胁情报，需要更多的数据输入，更多的分析资源投入，所以其得到的结果也包含了更大信息量。<p class="line" data-line="58">以下我们整理了基于Lockheed Martin Kill Chain模型各环节中可用于做关联性分析的维度。</p><center><table><thead><tr><th><strong>侦察跟踪</strong><th><strong>武器构建</strong><th><strong>载荷投递</strong><th><strong>突防利用</strong><th><strong>安装植入</strong><th><strong>通信控制</strong><th><strong>达成目标</strong><tbody><tr><td>目标国家<td>特定互斥量<td>恶意代码进入方式<td>漏洞利用<td>初始启动路径<td>域名注册信息<td>目标数据<tr><td>目标个体<td>执行流程<td>鱼叉邮件<td>社会工程学<td>持续启动方式<td>域名使用偏好<td>打包方法<tr><td>涉及行业<td>加解密方式<td>水坑攻击<td><td>伪装正常模式<td>域名命名偏好<td>传输方法<tr><td><td>特定功能模块<td>U盘<td><td><td>IP所在ASN<td>破坏功能<tr><td><td>对抗分析措施<td>主动渗透<td><td><td>后门工具<td><tr><td><td>源码工程路径<td><td><td><td>工具类型<td><tr><td><td>特定数据字串<td><td><td><td>工具配置<td><tr><td><td>语言编译环境<td><td><td><td>通信协议<td><tr><td><td>特定数字签名<td><td><td><td>认证凭据<td><tr><td><td>组件组织架构<td><td><td><td>SSL证书<td><tr><td><td>特别的错误<td><td><td><td><td></table></center><p class="line" data-line="76">来自Lockheed Martin的一个实际的多个攻击事件基于要素关联的例子：<p class="text-center line" data-line="78"><img src="/uploads/2017/07/25/46d475b0987decceed25d533d23f4a6b.png" alt=""><h4 class="line" data-line="80">组织情报</h4><p class="line" data-line="82">基于事件层次的事实收集与分析，我们可能可以分辨出多个攻击事件背后的同一个组织，并判定组织的来源、分工、资源状况、人员构成、行动目标等要素。<p class="line" data-line="84">通过分析对手所使用工具开发维护状况、突破技术及通信基础设施，可以推断对手的资源状况。一般来说，使用自己开发的成系列的漏洞利用及控制工具，通信网络使用了较多的IP、域名及服务器资源，载荷投递时显示出专业的针对性技巧，则可以判断对手拥有较强的能力，有足够的资源支持，组织内部可能存在明确的分工。<p class="line" data-line="86">组织的来源可以通过分析事件涉及的样本文件中包含的语言相关的特征来推断，比如字符串的语言、开发或打包工具的语言版本，对于非可执行的样本，也可以分析其默认的配置情况。在占有大量样本的情况下，可以通过分析样本的生成时间推断对手的日常工作时间，甚至休假情况，与特定国家的节假日做匹配，也可能成为分析对手来源的有效线索。如果有资源了解受影响目标的国家、行业及个体的分布，以及对手所发动的攻击类型（窃密型还是求财型）所使用的基础设施的地理位置，我们也可以非常有把握地推测出对手的来源。<p class="line" data-line="88">以下是Cylance一个名为Operation Cleaver的APT活动的来源要点分析：<p class="text-center line" data-line="90"><img src="/uploads/2017/07/25/cd97a55e18a34675df8f37d50c89f233.png" alt="" width="90%"> {<h4 class="line" data-line="92">人员情报</h4><p class="line" data-line="94">在组织之上的是人员相关的威胁情报，这是威胁分析的最后一环，实现虚拟身份到现实身份的映射。<p class="line" data-line="96">人处在威胁情报金字塔的顶端，因为它是整个威胁体系中最稳定的部分，一旦定位到人也就定位到了威胁产生的根源，解决人的问题是真正釜底抽薪的解决方案。弗诺·文奇写过一篇非常精彩的小说，名字就叫《真名实姓》，未来虚拟空间里最大的问题就是如何把其中的角色对应到现实中的人，一旦完成映射就意味着战斗的结束。这是因为如果我们处理的对象是人，就意味着解决问题的手段不会再受限于技术可能性。所有处于人之下的威胁情报类型我们一般只能采取技术手段来处理，比如我们知道一些攻击相关的IOC（样本、IP或域名），对其有效的处置手段主要局限于人工或自动化的识别、隔离及阻断等。而当我们对抗对象是人时，那么可采用的手段就可以丰富得多，我们不仅可以对目标本身还可以对其所在环境施加压力，利用人性的弱点就能实现类似降维攻击的效果。<p class="line" data-line="98">要得到这类情报，信息的输入也就不再限于技术分析，可能需要其他方面的数据输入及非常规的取证手段，比如真实注册信息、社交账号的关联数据、交易数据、蜜罐及反制。下图是360公司使用交互式数据关联系统对XcodeGhost事件的始作俑者的追溯演示，从攻击者所使用的一个C&C域名（做了隐私保护）出发通过层层前推最终定位到一个关联域名，而攻击者用其真实名字注册的它。<p class="text-center line" data-line="100"><img src="/uploads/2017/07/25/3145339917e5bd870cb7285522b4a5ba.png" alt="D:\work\skyeye\产品截图\xcode.JPG" width="90%"> {<h3 class="line" data-line="103"><strong>参考链接</strong></h3><p class="line" data-line="105"><a href="https://malwareconfig.com/">Malwareconfig</a><p class="line" data-line="107"><a href="https://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/butterfly-corporate-spies-out-for-financial-gain.pdf">Butterfly: Corporate spies out for fiancial gain</a><p class="line" data-line="109"><a href="https://www.blackhat.com/docs/us-15/materials/us-15-MarquisBoire-Big-Game-Hunting-The-Peculiarities-Of-Nation-State-Malware-Research.pdf">BIG GAME HUNTING: THE PECULIARITIES OF NATION-STATE MALWARE RESEARCH</a><p class="line" data-line="111"><a href="https://ti.360.com/upload/report/file/OceanLotusReport.pdf">OceanLotus (APT-C-00)数字海洋的游猎者</a><p class="line" data-line="113"><a href="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf">Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains</a><p class="line" data-line="115"><a href="https://cdn2.hubspot.net/hubfs/270968/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf">Operation Cleaver</a></div></div></section></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{articleData:{_id:"597733a71c670a09e493ee38",title:"威胁情报的层次分析",category:"安全观点",readableId:"level-of-threat-intelligence",abstract:"威胁情报，近几年来兴起的安全热点，已经从理念到技术再到平台逐步开始落地。不管是老牌的安全公司还是新兴的厂商都正在这方面探索，包括可行的技术方案、交换标准及商业模式。本文着重为读者介绍一下我所理解的威胁情报的层次，结合自身的实践，提出了一个金字塔模型，希望有助于提升业界对威胁情报的认识。",author:"汪列军",headImg:"/uploads/2017/08/17/16949b71be4886f4dbebd52178a1a204.png",descImg:"/uploads/2017/08/01/0e275715b71ac1ebf7c79054513124a2.png",tags:[],publish_time:"2016-04-22T17:32:44.000Z",content:'<h2 class="line" data-line="0">威胁情报的层次分析</h2>\n<p class="line" data-line="2">威胁情报，近几年来兴起的安全热点，已经从理念到技术再到平台逐步开始落地。不管是老牌的安全公司还是新兴的厂商都正在这方面探索，包括可行的技术方案、交换标准及商业模式。本文着重为读者介绍一下我所理解的威胁情报的层次，结合自身的实践，提出了一个金字塔模型，希望有助于提升业界对威胁情报的认识。</p>\n<h3 class="line" data-line="4">威胁情报的概念</h3>\n<p class="line" data-line="6">目前，Gartner对于威胁情报的定义比较广地被引用：</p>\n<p class="line" data-line="8">“Threat intelligence is evidence-based knowledge, including context, mechanisms, indicators, implications and actionable advice, about an existing or emerging menace or hazard to assets that can be used to inform decisions regarding the subject\'s response to that menace or hazard.”</p>\n<p class="line" data-line="10">这是一个比较理想化的定义，对情报应该包含的信息量提出了明确的要求，面向高端用户提供决策依据的完整情报样式，可以认为是狭义的威胁情报。</p>\n<p class="line" data-line="12">事实上，对于大多数的组织机构得不到上述这类准确和全面的情报服务，即便得到也无法采取应对措施。想象一下，即使有安全厂商能够告诉某个大公司一个安全威胁的背后的组织、国家背景甚至人员信息（这些都是高端威胁情报的必要组成部分），那又能如何？通常的组织机构不是执法机构，无法对这些情报采取什么缓解威胁的措施。</p>\n<p class="line" data-line="14">对一般的公司组织相对低端的入侵指示器（Indicator Of Compromise，IOC）可能更为实际些，它由可被边界安全设备和主机安全防护软件所使用的数据所构成，典型的入侵指示器有文件HASH、IP、域名、程序运行路径、注册表项等，这类威胁情报在下文有详细的分析。</p>\n<h3 class="line" data-line="16">威胁情报的作用</h3>\n<p class="line" data-line="18">通过对威胁情报的交换和共享，联合安全业界各方的力量，整合信息资源实现更大范围内的快速响应，以对抗也在不停进化的安全威胁。以下Webroot小纪念品上的图非常形象地表现了威胁情报所能起到的作用。</p>\n<p class="text-center line" data-line="20"><img src="/uploads/2017/07/25/869d3df44a6f8ecd3f9a9a262fb10259.png" alt=""></p>\n<p class="line" data-line="22">目前威胁情报作为一个安全关键词显得非常火热，但是显然被有些寄予了过高的期望，在安全领域不存在什么单点的银弹技术。准确及时的入侵指示数据可以帮助用户快速处理已经或正在发生的威胁，比如黑样本的HASH、对外连接的CC及Downloader服务器的IP或域名，网络边界设备或运行于主机上的Agent可以通过简单的匹配就能发现并采用自动化的应对措施。当用户试图分析一个可疑事件时，威胁情报可以为用户判定可疑事件的恶意性提供有用的参考资料，比如事件所涉及到的IP是否在某些已知的黑名单之中，相关的域名是否被已知的APT活动使用等。</p>\n<h3 class="line" data-line="24">威胁情报的层次</h3>\n<p class="text-center line" data-line="26"><img src="/uploads/2017/07/25/bc5008dcf0f163de8a317d8befd5eded.png" alt="" width="45%"></p>\n<p class="line" data-line="28">上图是我们构建的一个展示威胁情报层次的金字塔图，我们从下到上逐层解释一下每个层次的信息构成，所能发挥的作用及分析获取的方法。</p>\n<h4 class="line" data-line="30">文件HASH</h4>\n<p class="line" data-line="32">最底层威胁情报由文件构成，主要涉及恶意网络活动相关的各种恶意代码：Trojan、Backdoor、Downloader、Dropper等。一般来说，文件样本是整个事件分析的起点和基础性数据，其重要性相当于刑事案件调查中最主要的物证，比如凶器和尸体。用于标记文件的各种HASH是最基本威胁情报信息，可以方便地用于在目标系统上进行搜索，如果一个木马文件在系统上被发现则对象被感染的可能性就非常大。下图是Symantec发布的Butterfly攻击活动相关的部分文件HASH列表。</p>\n<p class="text-center line" data-line="34"><img src="/uploads/2017/07/25/797ed870122992cd8f261a4ff69eb6c9.png" alt="" width="90%"></p>\n<p class="line" data-line="36">绝大多数文件HASH的主要问题在于特异性太强，无论是MD5、SHA1、SHA256，只要文件出现一个比特位的变化就会导致完全不同的HASH值，这个特性在避免误报的同时也使攻击者可以通过最简单的内容修改来躲过检测，所以一旦被公开揭露，几乎立即过期。因此，文件HASH作为入侵指示器基本只能用来发现已发生的事件，对防御方来说需要用自动化的搜索匹配机制尽可能用其来缩短从事件发生到发现时间窗口，以尽可能减少损失。</p>\n<h4 class="line" data-line="38">主机和网络特征</h4>\n<p class="line" data-line="40">在文件HASH之上的是通过分析文件样本得到的直接关联的各类基于主机和网络特征，这些数据可以被用来作为入侵指示器。简单来说，主机特征可能包含恶意代码在机器上运行时产生的有区分能力的数据，比如程序运行时的Mutex、写入的注册表项、文件路径等，网络特征可能包含对外连接的C&amp;C或组件下载的IP/域名、访问的URL、通信协议等信息。下图是一个木马内置的主机与网络特征数据的例子。</p>\n<p class="text-center line" data-line="42"><img src="/uploads/2017/07/25/0952d915d9506860b3a4f8784debdacd.png" alt="" width="90%"></p>\n<p class="line" data-line="44">这些数据大多可以通过使样本运行于受控环境（沙箱和虚拟机）来获取，对于对抗强度较高的或无法运行的样本手工的逆向调试分析则有可能是必须的，这时就需要很大的时间与精力投入。相较于文件HASH，这些从文件中通过静态或动态分析得到的特征相对稳定，但改变的代价依然很小，特别是在被公开揭露出来以后，作为入侵指示器的价值也会很快消失。</p>\n<h4 class="line" data-line="46">事件层次情报</h4>\n<p class="line" data-line="48">在单个样本相关的信息以上为事件层次的威胁情报。当我们得到了大量文件样本相关的细节以后，通过分析其各个维度上的相似度就可以实现样本家族的分类。下图是三个疑似欧洲来源的秘密监控软件基于样本特征的同源性分析，可以看到一些关键特征保持一致，暗示它们有共同的源头。</p>\n<p class="text-center line" data-line="50"><img src="/uploads/2017/07/25/fd9f10aa52b4ba6c312ceb500b0cd377.png" alt="" width="90%"></p>\n<p class="line" data-line="52">通过分析样本之间的上下游关系，可以推断攻击发生时恶意代码的进入渠道，从而了解对手的攻击手法，通过鱼叉邮件、水坑攻击、U盘植入还是其他主动性的攻击，是否利用了安全漏洞，使用了什么样的社工技巧。了解攻击的方法对于防御方调整防护方案，填补漏洞和盲点，使防护更有针对性同时降低成本有重要的意义。下图是2015年360公司揭露的海莲花APT事件中攻击者所使用的恶意代码感染方式。</p>\n<p class="text-center line" data-line="54"><img src="/uploads/2017/07/25/9327cd893ec3f6e366e17d5e7448a629.png" alt="" width="90%"></p>\n<p class="line" data-line="56">如果收集到的数据包含受害者内部网络和主机的行为，我们还能了解攻击者在受害者内部系统中尝试进一步获取控制的方式和方法。因此，要得到的准确的事件层次的威胁情报，需要更多的数据输入，更多的分析资源投入，所以其得到的结果也包含了更大信息量。</p>\n<p class="line" data-line="58">以下我们整理了基于Lockheed Martin Kill Chain模型各环节中可用于做关联性分析的维度。</p>\n<center><table>\n<thead>\n<tr>\n<th><strong>侦察跟踪</strong></th>\n<th><strong>武器构建</strong></th>\n<th><strong>载荷投递</strong></th>\n<th><strong>突防利用</strong></th>\n<th><strong>安装植入</strong></th>\n<th><strong>通信控制</strong></th>\n<th><strong>达成目标</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>目标国家</td>\n<td>特定互斥量</td>\n<td>恶意代码进入方式</td>\n<td>漏洞利用</td>\n<td>初始启动路径</td>\n<td>域名注册信息</td>\n<td>目标数据</td>\n</tr>\n<tr>\n<td>目标个体</td>\n<td>执行流程</td>\n<td>鱼叉邮件</td>\n<td>社会工程学</td>\n<td>持续启动方式</td>\n<td>域名使用偏好</td>\n<td>打包方法</td>\n</tr>\n<tr>\n<td>涉及行业</td>\n<td>加解密方式</td>\n<td>水坑攻击</td>\n<td></td>\n<td>伪装正常模式</td>\n<td>域名命名偏好</td>\n<td>传输方法</td>\n</tr>\n<tr>\n<td></td>\n<td>特定功能模块</td>\n<td>U盘</td>\n<td></td>\n<td></td>\n<td>IP所在ASN</td>\n<td>破坏功能</td>\n</tr>\n<tr>\n<td></td>\n<td>对抗分析措施</td>\n<td>主动渗透</td>\n<td></td>\n<td></td>\n<td>后门工具</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>源码工程路径</td>\n<td></td>\n<td></td>\n<td></td>\n<td>工具类型</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>特定数据字串</td>\n<td></td>\n<td></td>\n<td></td>\n<td>工具配置</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>语言编译环境</td>\n<td></td>\n<td></td>\n<td></td>\n<td>通信协议</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>特定数字签名</td>\n<td></td>\n<td></td>\n<td></td>\n<td>认证凭据</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>组件组织架构</td>\n<td></td>\n<td></td>\n<td></td>\n<td>SSL证书</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>特别的错误</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</center>\n<p class="line" data-line="76">来自Lockheed Martin的一个实际的多个攻击事件基于要素关联的例子：</p>\n<p class="text-center line" data-line="78"><img src="/uploads/2017/07/25/46d475b0987decceed25d533d23f4a6b.png" alt=""></p>\n<h4 class="line" data-line="80">组织情报</h4>\n<p class="line" data-line="82">基于事件层次的事实收集与分析，我们可能可以分辨出多个攻击事件背后的同一个组织，并判定组织的来源、分工、资源状况、人员构成、行动目标等要素。</p>\n<p class="line" data-line="84">通过分析对手所使用工具开发维护状况、突破技术及通信基础设施，可以推断对手的资源状况。一般来说，使用自己开发的成系列的漏洞利用及控制工具，通信网络使用了较多的IP、域名及服务器资源，载荷投递时显示出专业的针对性技巧，则可以判断对手拥有较强的能力，有足够的资源支持，组织内部可能存在明确的分工。</p>\n<p class="line" data-line="86">组织的来源可以通过分析事件涉及的样本文件中包含的语言相关的特征来推断，比如字符串的语言、开发或打包工具的语言版本，对于非可执行的样本，也可以分析其默认的配置情况。在占有大量样本的情况下，可以通过分析样本的生成时间推断对手的日常工作时间，甚至休假情况，与特定国家的节假日做匹配，也可能成为分析对手来源的有效线索。如果有资源了解受影响目标的国家、行业及个体的分布，以及对手所发动的攻击类型（窃密型还是求财型）所使用的基础设施的地理位置，我们也可以非常有把握地推测出对手的来源。</p>\n<p class="line" data-line="88">以下是Cylance一个名为Operation Cleaver的APT活动的来源要点分析：</p>\n<p class="text-center line" data-line="90"><img src="/uploads/2017/07/25/cd97a55e18a34675df8f37d50c89f233.png" alt="" width="90%"> {</p>\n<h4 class="line" data-line="92">人员情报</h4>\n<p class="line" data-line="94">在组织之上的是人员相关的威胁情报，这是威胁分析的最后一环，实现虚拟身份到现实身份的映射。</p>\n<p class="line" data-line="96">人处在威胁情报金字塔的顶端，因为它是整个威胁体系中最稳定的部分，一旦定位到人也就定位到了威胁产生的根源，解决人的问题是真正釜底抽薪的解决方案。弗诺·文奇写过一篇非常精彩的小说，名字就叫《真名实姓》，未来虚拟空间里最大的问题就是如何把其中的角色对应到现实中的人，一旦完成映射就意味着战斗的结束。这是因为如果我们处理的对象是人，就意味着解决问题的手段不会再受限于技术可能性。所有处于人之下的威胁情报类型我们一般只能采取技术手段来处理，比如我们知道一些攻击相关的IOC（样本、IP或域名），对其有效的处置手段主要局限于人工或自动化的识别、隔离及阻断等。而当我们对抗对象是人时，那么可采用的手段就可以丰富得多，我们不仅可以对目标本身还可以对其所在环境施加压力，利用人性的弱点就能实现类似降维攻击的效果。</p>\n<p class="line" data-line="98">要得到这类情报，信息的输入也就不再限于技术分析，可能需要其他方面的数据输入及非常规的取证手段，比如真实注册信息、社交账号的关联数据、交易数据、蜜罐及反制。下图是360公司使用交互式数据关联系统对XcodeGhost事件的始作俑者的追溯演示，从攻击者所使用的一个C&amp;C域名（做了隐私保护）出发通过层层前推最终定位到一个关联域名，而攻击者用其真实名字注册的它。</p>\n<p class="text-center line" data-line="100"><img src="/uploads/2017/07/25/3145339917e5bd870cb7285522b4a5ba.png" alt="D:\\work\\skyeye\\产品截图\\xcode.JPG" width="90%"> {</p>\n<h3 class="line" data-line="103"><strong>参考链接</strong></h3>\n<p class="line" data-line="105"><a href="https://malwareconfig.com/">Malwareconfig</a></p>\n<p class="line" data-line="107"><a href="https://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/butterfly-corporate-spies-out-for-financial-gain.pdf">Butterfly: Corporate spies out for fiancial gain</a></p>\n<p class="line" data-line="109"><a href="https://www.blackhat.com/docs/us-15/materials/us-15-MarquisBoire-Big-Game-Hunting-The-Peculiarities-Of-Nation-State-Malware-Research.pdf">BIG GAME HUNTING: THE PECULIARITIES OF NATION-STATE MALWARE RESEARCH</a></p>\n<p class="line" data-line="111"><a href="https://ti.360.com/upload/report/file/OceanLotusReport.pdf">OceanLotus (APT-C-00)数字海洋的游猎者</a></p>\n<p class="line" data-line="113"><a href="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf">Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains</a></p>\n<p class="line" data-line="115"><a href="https://cdn2.hubspot.net/hubfs/270968/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf">Operation Cleaver</a></p>\n'}}],error:null,state:{pageId:[],tagParam:[],isMainPage:!1,pageNum:[1,2],articleData:{_id:"597733a71c670a09e493ee38",title:"威胁情报的层次分析",category:"安全观点",readableId:"level-of-threat-intelligence",abstract:"威胁情报，近几年来兴起的安全热点，已经从理念到技术再到平台逐步开始落地。不管是老牌的安全公司还是新兴的厂商都正在这方面探索，包括可行的技术方案、交换标准及商业模式。本文着重为读者介绍一下我所理解的威胁情报的层次，结合自身的实践，提出了一个金字塔模型，希望有助于提升业界对威胁情报的认识。",author:"汪列军",headImg:"/uploads/2017/08/17/16949b71be4886f4dbebd52178a1a204.png",descImg:"/uploads/2017/08/01/0e275715b71ac1ebf7c79054513124a2.png",tags:[],publish_time:"2016-04-22T17:32:44.000Z",content:'<h2 class="line" data-line="0">威胁情报的层次分析</h2>\n<p class="line" data-line="2">威胁情报，近几年来兴起的安全热点，已经从理念到技术再到平台逐步开始落地。不管是老牌的安全公司还是新兴的厂商都正在这方面探索，包括可行的技术方案、交换标准及商业模式。本文着重为读者介绍一下我所理解的威胁情报的层次，结合自身的实践，提出了一个金字塔模型，希望有助于提升业界对威胁情报的认识。</p>\n<h3 class="line" data-line="4">威胁情报的概念</h3>\n<p class="line" data-line="6">目前，Gartner对于威胁情报的定义比较广地被引用：</p>\n<p class="line" data-line="8">“Threat intelligence is evidence-based knowledge, including context, mechanisms, indicators, implications and actionable advice, about an existing or emerging menace or hazard to assets that can be used to inform decisions regarding the subject\'s response to that menace or hazard.”</p>\n<p class="line" data-line="10">这是一个比较理想化的定义，对情报应该包含的信息量提出了明确的要求，面向高端用户提供决策依据的完整情报样式，可以认为是狭义的威胁情报。</p>\n<p class="line" data-line="12">事实上，对于大多数的组织机构得不到上述这类准确和全面的情报服务，即便得到也无法采取应对措施。想象一下，即使有安全厂商能够告诉某个大公司一个安全威胁的背后的组织、国家背景甚至人员信息（这些都是高端威胁情报的必要组成部分），那又能如何？通常的组织机构不是执法机构，无法对这些情报采取什么缓解威胁的措施。</p>\n<p class="line" data-line="14">对一般的公司组织相对低端的入侵指示器（Indicator Of Compromise，IOC）可能更为实际些，它由可被边界安全设备和主机安全防护软件所使用的数据所构成，典型的入侵指示器有文件HASH、IP、域名、程序运行路径、注册表项等，这类威胁情报在下文有详细的分析。</p>\n<h3 class="line" data-line="16">威胁情报的作用</h3>\n<p class="line" data-line="18">通过对威胁情报的交换和共享，联合安全业界各方的力量，整合信息资源实现更大范围内的快速响应，以对抗也在不停进化的安全威胁。以下Webroot小纪念品上的图非常形象地表现了威胁情报所能起到的作用。</p>\n<p class="text-center line" data-line="20"><img src="/uploads/2017/07/25/869d3df44a6f8ecd3f9a9a262fb10259.png" alt=""></p>\n<p class="line" data-line="22">目前威胁情报作为一个安全关键词显得非常火热，但是显然被有些寄予了过高的期望，在安全领域不存在什么单点的银弹技术。准确及时的入侵指示数据可以帮助用户快速处理已经或正在发生的威胁，比如黑样本的HASH、对外连接的CC及Downloader服务器的IP或域名，网络边界设备或运行于主机上的Agent可以通过简单的匹配就能发现并采用自动化的应对措施。当用户试图分析一个可疑事件时，威胁情报可以为用户判定可疑事件的恶意性提供有用的参考资料，比如事件所涉及到的IP是否在某些已知的黑名单之中，相关的域名是否被已知的APT活动使用等。</p>\n<h3 class="line" data-line="24">威胁情报的层次</h3>\n<p class="text-center line" data-line="26"><img src="/uploads/2017/07/25/bc5008dcf0f163de8a317d8befd5eded.png" alt="" width="45%"></p>\n<p class="line" data-line="28">上图是我们构建的一个展示威胁情报层次的金字塔图，我们从下到上逐层解释一下每个层次的信息构成，所能发挥的作用及分析获取的方法。</p>\n<h4 class="line" data-line="30">文件HASH</h4>\n<p class="line" data-line="32">最底层威胁情报由文件构成，主要涉及恶意网络活动相关的各种恶意代码：Trojan、Backdoor、Downloader、Dropper等。一般来说，文件样本是整个事件分析的起点和基础性数据，其重要性相当于刑事案件调查中最主要的物证，比如凶器和尸体。用于标记文件的各种HASH是最基本威胁情报信息，可以方便地用于在目标系统上进行搜索，如果一个木马文件在系统上被发现则对象被感染的可能性就非常大。下图是Symantec发布的Butterfly攻击活动相关的部分文件HASH列表。</p>\n<p class="text-center line" data-line="34"><img src="/uploads/2017/07/25/797ed870122992cd8f261a4ff69eb6c9.png" alt="" width="90%"></p>\n<p class="line" data-line="36">绝大多数文件HASH的主要问题在于特异性太强，无论是MD5、SHA1、SHA256，只要文件出现一个比特位的变化就会导致完全不同的HASH值，这个特性在避免误报的同时也使攻击者可以通过最简单的内容修改来躲过检测，所以一旦被公开揭露，几乎立即过期。因此，文件HASH作为入侵指示器基本只能用来发现已发生的事件，对防御方来说需要用自动化的搜索匹配机制尽可能用其来缩短从事件发生到发现时间窗口，以尽可能减少损失。</p>\n<h4 class="line" data-line="38">主机和网络特征</h4>\n<p class="line" data-line="40">在文件HASH之上的是通过分析文件样本得到的直接关联的各类基于主机和网络特征，这些数据可以被用来作为入侵指示器。简单来说，主机特征可能包含恶意代码在机器上运行时产生的有区分能力的数据，比如程序运行时的Mutex、写入的注册表项、文件路径等，网络特征可能包含对外连接的C&amp;C或组件下载的IP/域名、访问的URL、通信协议等信息。下图是一个木马内置的主机与网络特征数据的例子。</p>\n<p class="text-center line" data-line="42"><img src="/uploads/2017/07/25/0952d915d9506860b3a4f8784debdacd.png" alt="" width="90%"></p>\n<p class="line" data-line="44">这些数据大多可以通过使样本运行于受控环境（沙箱和虚拟机）来获取，对于对抗强度较高的或无法运行的样本手工的逆向调试分析则有可能是必须的，这时就需要很大的时间与精力投入。相较于文件HASH，这些从文件中通过静态或动态分析得到的特征相对稳定，但改变的代价依然很小，特别是在被公开揭露出来以后，作为入侵指示器的价值也会很快消失。</p>\n<h4 class="line" data-line="46">事件层次情报</h4>\n<p class="line" data-line="48">在单个样本相关的信息以上为事件层次的威胁情报。当我们得到了大量文件样本相关的细节以后，通过分析其各个维度上的相似度就可以实现样本家族的分类。下图是三个疑似欧洲来源的秘密监控软件基于样本特征的同源性分析，可以看到一些关键特征保持一致，暗示它们有共同的源头。</p>\n<p class="text-center line" data-line="50"><img src="/uploads/2017/07/25/fd9f10aa52b4ba6c312ceb500b0cd377.png" alt="" width="90%"></p>\n<p class="line" data-line="52">通过分析样本之间的上下游关系，可以推断攻击发生时恶意代码的进入渠道，从而了解对手的攻击手法，通过鱼叉邮件、水坑攻击、U盘植入还是其他主动性的攻击，是否利用了安全漏洞，使用了什么样的社工技巧。了解攻击的方法对于防御方调整防护方案，填补漏洞和盲点，使防护更有针对性同时降低成本有重要的意义。下图是2015年360公司揭露的海莲花APT事件中攻击者所使用的恶意代码感染方式。</p>\n<p class="text-center line" data-line="54"><img src="/uploads/2017/07/25/9327cd893ec3f6e366e17d5e7448a629.png" alt="" width="90%"></p>\n<p class="line" data-line="56">如果收集到的数据包含受害者内部网络和主机的行为，我们还能了解攻击者在受害者内部系统中尝试进一步获取控制的方式和方法。因此，要得到的准确的事件层次的威胁情报，需要更多的数据输入，更多的分析资源投入，所以其得到的结果也包含了更大信息量。</p>\n<p class="line" data-line="58">以下我们整理了基于Lockheed Martin Kill Chain模型各环节中可用于做关联性分析的维度。</p>\n<center><table>\n<thead>\n<tr>\n<th><strong>侦察跟踪</strong></th>\n<th><strong>武器构建</strong></th>\n<th><strong>载荷投递</strong></th>\n<th><strong>突防利用</strong></th>\n<th><strong>安装植入</strong></th>\n<th><strong>通信控制</strong></th>\n<th><strong>达成目标</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>目标国家</td>\n<td>特定互斥量</td>\n<td>恶意代码进入方式</td>\n<td>漏洞利用</td>\n<td>初始启动路径</td>\n<td>域名注册信息</td>\n<td>目标数据</td>\n</tr>\n<tr>\n<td>目标个体</td>\n<td>执行流程</td>\n<td>鱼叉邮件</td>\n<td>社会工程学</td>\n<td>持续启动方式</td>\n<td>域名使用偏好</td>\n<td>打包方法</td>\n</tr>\n<tr>\n<td>涉及行业</td>\n<td>加解密方式</td>\n<td>水坑攻击</td>\n<td></td>\n<td>伪装正常模式</td>\n<td>域名命名偏好</td>\n<td>传输方法</td>\n</tr>\n<tr>\n<td></td>\n<td>特定功能模块</td>\n<td>U盘</td>\n<td></td>\n<td></td>\n<td>IP所在ASN</td>\n<td>破坏功能</td>\n</tr>\n<tr>\n<td></td>\n<td>对抗分析措施</td>\n<td>主动渗透</td>\n<td></td>\n<td></td>\n<td>后门工具</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>源码工程路径</td>\n<td></td>\n<td></td>\n<td></td>\n<td>工具类型</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>特定数据字串</td>\n<td></td>\n<td></td>\n<td></td>\n<td>工具配置</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>语言编译环境</td>\n<td></td>\n<td></td>\n<td></td>\n<td>通信协议</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>特定数字签名</td>\n<td></td>\n<td></td>\n<td></td>\n<td>认证凭据</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>组件组织架构</td>\n<td></td>\n<td></td>\n<td></td>\n<td>SSL证书</td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td>特别的错误</td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n</center>\n<p class="line" data-line="76">来自Lockheed Martin的一个实际的多个攻击事件基于要素关联的例子：</p>\n<p class="text-center line" data-line="78"><img src="/uploads/2017/07/25/46d475b0987decceed25d533d23f4a6b.png" alt=""></p>\n<h4 class="line" data-line="80">组织情报</h4>\n<p class="line" data-line="82">基于事件层次的事实收集与分析，我们可能可以分辨出多个攻击事件背后的同一个组织，并判定组织的来源、分工、资源状况、人员构成、行动目标等要素。</p>\n<p class="line" data-line="84">通过分析对手所使用工具开发维护状况、突破技术及通信基础设施，可以推断对手的资源状况。一般来说，使用自己开发的成系列的漏洞利用及控制工具，通信网络使用了较多的IP、域名及服务器资源，载荷投递时显示出专业的针对性技巧，则可以判断对手拥有较强的能力，有足够的资源支持，组织内部可能存在明确的分工。</p>\n<p class="line" data-line="86">组织的来源可以通过分析事件涉及的样本文件中包含的语言相关的特征来推断，比如字符串的语言、开发或打包工具的语言版本，对于非可执行的样本，也可以分析其默认的配置情况。在占有大量样本的情况下，可以通过分析样本的生成时间推断对手的日常工作时间，甚至休假情况，与特定国家的节假日做匹配，也可能成为分析对手来源的有效线索。如果有资源了解受影响目标的国家、行业及个体的分布，以及对手所发动的攻击类型（窃密型还是求财型）所使用的基础设施的地理位置，我们也可以非常有把握地推测出对手的来源。</p>\n<p class="line" data-line="88">以下是Cylance一个名为Operation Cleaver的APT活动的来源要点分析：</p>\n<p class="text-center line" data-line="90"><img src="/uploads/2017/07/25/cd97a55e18a34675df8f37d50c89f233.png" alt="" width="90%"> {</p>\n<h4 class="line" data-line="92">人员情报</h4>\n<p class="line" data-line="94">在组织之上的是人员相关的威胁情报，这是威胁分析的最后一环，实现虚拟身份到现实身份的映射。</p>\n<p class="line" data-line="96">人处在威胁情报金字塔的顶端，因为它是整个威胁体系中最稳定的部分，一旦定位到人也就定位到了威胁产生的根源，解决人的问题是真正釜底抽薪的解决方案。弗诺·文奇写过一篇非常精彩的小说，名字就叫《真名实姓》，未来虚拟空间里最大的问题就是如何把其中的角色对应到现实中的人，一旦完成映射就意味着战斗的结束。这是因为如果我们处理的对象是人，就意味着解决问题的手段不会再受限于技术可能性。所有处于人之下的威胁情报类型我们一般只能采取技术手段来处理，比如我们知道一些攻击相关的IOC（样本、IP或域名），对其有效的处置手段主要局限于人工或自动化的识别、隔离及阻断等。而当我们对抗对象是人时，那么可采用的手段就可以丰富得多，我们不仅可以对目标本身还可以对其所在环境施加压力，利用人性的弱点就能实现类似降维攻击的效果。</p>\n<p class="line" data-line="98">要得到这类情报，信息的输入也就不再限于技术分析，可能需要其他方面的数据输入及非常规的取证手段，比如真实注册信息、社交账号的关联数据、交易数据、蜜罐及反制。下图是360公司使用交互式数据关联系统对XcodeGhost事件的始作俑者的追溯演示，从攻击者所使用的一个C&amp;C域名（做了隐私保护）出发通过层层前推最终定位到一个关联域名，而攻击者用其真实名字注册的它。</p>\n<p class="text-center line" data-line="100"><img src="/uploads/2017/07/25/3145339917e5bd870cb7285522b4a5ba.png" alt="D:\\work\\skyeye\\产品截图\\xcode.JPG" width="90%"> {</p>\n<h3 class="line" data-line="103"><strong>参考链接</strong></h3>\n<p class="line" data-line="105"><a href="https://malwareconfig.com/">Malwareconfig</a></p>\n<p class="line" data-line="107"><a href="https://www.symantec.com/content/en/us/enterprise/media/security_response/whitepapers/butterfly-corporate-spies-out-for-financial-gain.pdf">Butterfly: Corporate spies out for fiancial gain</a></p>\n<p class="line" data-line="109"><a href="https://www.blackhat.com/docs/us-15/materials/us-15-MarquisBoire-Big-Game-Hunting-The-Peculiarities-Of-Nation-State-Malware-Research.pdf">BIG GAME HUNTING: THE PECULIARITIES OF NATION-STATE MALWARE RESEARCH</a></p>\n<p class="line" data-line="111"><a href="https://ti.360.com/upload/report/file/OceanLotusReport.pdf">OceanLotus (APT-C-00)数字海洋的游猎者</a></p>\n<p class="line" data-line="113"><a href="http://www.lockheedmartin.com/content/dam/lockheed/data/corporate/documents/LM-White-Paper-Intel-Driven-Defense.pdf">Intelligence-Driven Computer Network Defense Informed by Analysis of Adversary Campaigns and Intrusion Kill Chains</a></p>\n<p class="line" data-line="115"><a href="https://cdn2.hubspot.net/hubfs/270968/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf">Operation Cleaver</a></p>\n'}},serverRendered:!0}</script><script defer src="/_nuxt/manifest.cc16cbbf77dfa41bad8e.js"></script><script defer src="/_nuxt/vendor.bundle.45eca4dc7fa9e1bc4361.js"></script><script defer src="/_nuxt/nuxt.bundle.8e9d53f64bed77ebfe81.js"></script>