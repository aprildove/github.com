<!DOCTYPE html><html data-n-head="" data-n-head-ssr><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="Nuxt.js project" name="description" data-hid="description"><title data-n-head="true">360威胁情报中心</title><link href="/fav.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="/_nuxt/manifest.38f62477280dcc27df9e.js" rel="preload" as="script"><link href="/_nuxt/vendor.bundle.45eca4dc7fa9e1bc4361.js" rel="preload" as="script"><link href="/_nuxt/nuxt.bundle.8e9d53f64bed77ebfe81.js" rel="preload" as="script"><link href="/_nuxt/0.nuxt.bundle.2f45ca512d92831b456d.js" rel="prefetch"><link href="/_nuxt/1.nuxt.bundle.ddf9ea85dc483e3df228.js" rel="prefetch"><link href="/_nuxt/2.nuxt.bundle.ae682d6568221e03d161.js" rel="prefetch"><link href="/_nuxt/3.nuxt.bundle.55fb549cb8ff45291a32.js" rel="prefetch"><link href="/_nuxt/4.nuxt.bundle.34c699b301359d6a3c4d.js" rel="prefetch"><link href="/_nuxt/5.nuxt.bundle.1375829ca49ba88d696d.js" rel="prefetch"><style data-vue-ssr-id="1cbf7f39:0 198c0e1e:0 034fd8e0:0 ba3a09e0:0 c2ba7178:0 01cb4693:0 69b5e360:0">.progress[data-v-862bdd9c]{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;-o-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}.hljs ::-webkit-scrollbar{width:8px;height:10px;border-radius:2px;background-color:#839496}.hljs ::-webkit-scrollbar-track{background-color:#bebebe}.hljs ::-webkit-scrollbar-thumb,.hljs ::-webkit-scrollbar-track{border-radius:2px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3)}.hljs ::-webkit-scrollbar-thumb{background-color:#789}html{font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box}body{background-color:rgba(66,66,66,.05)}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;text-decoration:none}li{list-style-type:none}a:active,a:hover,a:link,a:visited{color:#0b1802}.main-body h1,.main-body h2,.main-body h3,.main-body h4,.main-body h5,.main-body h6{margin-top:0;margin-bottom:.5rem}.main-body p{margin-top:0;margin-bottom:1rem;font-size:15px;text-indent:25px;word-wrap:break-word}.main-body img{vertical-align:middle;border-style:none;margin:auto 20px auto auto;padding:3px;border-radius:3px;background-color:#e6e6d5;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.15);box-shadow:0 1px 2px rgba(0,0,0,.15);border:1px solid #b9baa6}.main-body .text-center{text-align:center!important}.main-body table{border-collapse:collapse!important;width:100%;max-width:100%;margin:1em 0;background-color:transparent}.main-body table tbody+tbody{border-top:2px solid #e9ecef}.main-body table td,.main-body table th{padding:.5rem;font-size:.95em;border-collapse:collapse}.main-body table tr{border:1px solid #dfe8fe}.main-body table tr:nth-child(odd){background-color:#ecf1fe}.main-body table tr:nth-child(2n){background-color:#fdfdfd}.main-body table td{white-space:normal;word-break:break-all}.main-body code,.main-body kbd,.main-body pre,.main-body samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.nav-bar[data-v-42857612]{height:60px;border-bottom:1px solid #d5d5d5}.nav-bar .ico-favicon[data-v-42857612]{height:28px;margin-top:16px;margin-left:108px;cursor:pointer}.nav-bar .ico-home[data-v-42857612]{width:32px;height:32px;display:inline-block;margin:16px 32px;float:right;cursor:pointer;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACU0lEQVRYR+2XzZHaQBCFX48cAM4AStxNBmYzACSfDREYIjAbAcoA9mwkcARmM1jfocAZbADWPNfIDAtaCUmUXdhV6Cjm5+vX3Y+W4MqPXPl+XAzQWWxrSuvPJgCt1P2y23i+JJiLADqLbcuJ9RSCVnIp8RQ7arDsNp6qQlQG6IXrPiATIYTCoblQKAEFBDiKvOasCkRpgL3kEwH6BL5rpfo2YqOI0nomwDsCM63UqGxKSgGcSE4+xI4zTF9gAJ04DiDysUpKCgHSkhdJbNZXSUkuQJ7k+0inFHmMPDfIync6JZHnDvLqIhOgs9jWnVgvkio/kvxwMDkO/ebyXLFlpKS77DZ26T2vALz5ukORqQA1ggMreS/cmIrva6U6WQflwZh9AkwIPAs5SIOfAHjzTQDBJ3tY6LliJQfkR+i7SdtVfXrhZixAYloEgshzR/aMA0AvXK8E8h7kV4rUTUsZALMZ4K6o+M5BWQDTvuZckKvQb94lHmI3mugp2JnCsjAWQGm1mn9orKpGbtdbANHqTivdEqJu1cwswr8JkA7kBlCogOmCsr5+phWTLjA18P+lwP+ybf98g501nxdfQC0r4thxzD/hyVxw3AWVFUhfYp0ttyXJh9Bv9o9//9MAufn0wg0JPkZes30DuCnwTyoQK/U2bWqZTniYC8hueoA411L5XbBeCaUV+u4r78gEMOZDpb/Zjw6Ah6+e/axQN5Pv8ftkrUh7P/kcjIgird/TFe4jzx0XjmR2QQIh8ZCS7XhlZwMhDPwsb4YsHMvLXnTpuqsD/AKIkSQ/Gqk/IAAAAABJRU5ErkJggg==) no-repeat}.nav-bar .ico-home[data-v-42857612]:hover{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACRElEQVRYR+2XT5LSQBTGvy9B13gDbmBuIJSJ65kTGKqEciecQOYEsJxKrII5gboVLJgbzNwAb8Aah7ypjmnMNPlLaaFV9DLV3e/3vvcnr4kTL57YPo4G8JfSfP6Aj8qBbQNXsw43xzhzFEDvmzggpiQcZVQEdxB0wze8qwtRG6D3XXwIxhRQLAyUQUaYCCEghuFrzupAVAZQkj/bYUzAB3AvEXztsVKEFpThlwLMftoYVg1JJQBD8putjYFpIM6JHSYA3tYJSSmAKXmZxGp/nZDkAuRJnng6heA28Kg8PlhmSEKX3by8yAR4v5TW7gGfkyzfS566eBS4/FKUbGZI7AYurztcm2cOAPoLuRBgSqApRFdL3p/LAIRv2bjIuigPJjk3FmBDoGuCPwHoLWRC4IO+LHBJLbkAP0KXcdnVXf25jMBfTQuCSeBxqO/YA/TmsiLxSgRfSbRUSSkAdVgsrMuSrwgqBXCflOoqdNmJe4g+GHsvWKvE0jAaIAJWnzyu6nqu92uASNCxAEeIllYzMwn/JoDpyBmgVAFVBVX7ekEpxlWgcuD/C8G7ubQbDax180n1hWamxxGG5lyQroLaCphGdGcrKMmbwKX6Ze/XnwbIjWd/ISKC29Bj+wxwVuCfVGBr44XZ1LI74e+54NIcIIpKKq8K4p8b4AQeD3pHJoBqPhaxjOcH9egg9q8eIp4VWub35N/eVpMPgPQDxVHTFQRXgcdR6UimNygIIn54ZHe86sPBhsQsb4YsHcur2zlu58kBHgGcWwk/vbbC3wAAAABJRU5ErkJggg==) no-repeat}.disPic .pic[data-v-42857612]{background-color:#faa732;height:480px;width:100%}.article-page[data-v-8db87e62]{margin:0 auto;max-width:1108px;background-size:cover}.article-page .page-header[data-v-8db87e62]{border-bottom:1px solid #efefef}.article-page .page-header .ava img[data-v-8db87e62]{border-radius:50%;height:56px;width:56px;float:left;margin:12px}.article-page .page-header .title[data-v-8db87e62]{font-size:48px;color:#0b1802;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'"}.article-page .page-header .author[data-v-8db87e62]{display:inline-block;color:#979996;font-size:16px;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'";margin:12px 7px 12px 0;line-height:16px}.article-page .page-header .author .ico-time img[data-v-8db87e62]{width:16px;height:16px}.article-page .main-body[data-v-8db87e62]{padding:0 108px;margin:28px auto 168px;background:url(/_nuxt/img/post-entry-bg.98216ca.png) no-repeat -10px 9px}.article-page .back-top[data-v-8db87e62]{width:48px;height:48px;position:fixed;bottom:30px;right:20px;background:url(/_nuxt/img/top.1d1a857.png) no-repeat}.article-page .back-top[data-v-8db87e62]:hover{cursor:pointer;background:url(/_nuxt/img/top-light.0cd636b.png) no-repeat}.title-home[data-v-552f8598]{font-family:sans-serif;line-height:32px;font-size:24px;color:#0b1802;cursor:pointer;max-height:32px;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.title-home[data-v-552f8598]:hover{text-shadow:2px 3px 1px #d0d0d0}.title-detail[data-v-552f8598]{font-size:48px;color:#0b1802;font-family:Arial Rounded MT Bold;margin-top:48px;line-height:64px}@media screen and (min-width:550px) and (max-width:950px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}@media screen and (max-width:550px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}.tags[data-v-53a17526]{height:42px;padding-top:10px}.tag[data-v-53a17526]{background-color:#6aacd8;display:inline-block;height:22px;font-size:13px;color:#fefefe;font-family:sans-serif;padding:2px 6px;margin-right:8px;border-radius:2px}</style><body data-n-head=""><div data-server-rendered="true" id="__nuxt"><div class="progress" data-v-862bdd9c style="width:0%;height:2px;background-color:#3b8070;opacity:0"></div><div><section><div data-v-42857612><div class="nav-bar" data-v-42857612><a href="/" data-v-42857612><img src="/_nuxt/img/blog-icon.f80549d.png" class="ico-favicon" data-v-42857612></a><div class="ico-home" data-v-42857612></div></div><!----></div><div class="article-page" data-v-8db87e62><div class="page-header" data-v-8db87e62><div class="title-detail" data-v-552f8598 data-v-8db87e62>Template Injection 攻击事件: 隐藏在模板文件后的威胁</div><div class="ava" data-v-8db87e62><img data-v-8db87e62></div><div class="tags" data-v-53a17526 data-v-8db87e62><p class="tag" data-v-53a17526>DOCX<p class="tag" data-v-53a17526>TEMPLATE INJECTION<p class="tag" data-v-53a17526>OFFICE</div><div class="author lh32" data-v-8db87e62>白皓文 on</div></div><div class="main-body" data-v-8db87e62><h2 class="line" data-line="0">事件背景</h2><p class="line" data-line="3">《纽约时报》和彭博社上周透露，联邦调查局和国土安全部发布了一份联合报告称：美国的制造工厂、核电站和其他能源设施正遭受网络攻击的威胁。此次袭击至少攻击了美国十几家电力公司，包括在堪萨斯州的 Wolf Creek核设施。<p class="line" data-line="5">随后，思科Talos情报和研究小组称，最近攻击者在针对美国能源设施和其他重要基础设施组织的攻击中使用了一种叫做模板注入（<code>Template Injection</code>）的技术。<p class="line" data-line="7">360天眼实验室针对此次事件中使用到的恶意样本进行了一些技术分析，详细分析了<code>Template Injection</code>所有可能用到的攻击技术，并且通过关联分析追溯到此次攻击最早可能发生在今年3月。<h2 class="line" data-line="9">Office文档模板</h2><p class="line" data-line="12">Office文档模板是Office文档制作和编辑中重要的一个部分，生成文档模板能够很快的按照固定模板进行设置，直接快速的进行文档处理，Office可以引用本地或者网络上的模板文档。此类文件的后缀一般为<code>.dot</code>、<code>.dotx</code>、<code>.dotm</code>等。<h2 class="line" data-line="14">样本分析</h2><table><thead><tr><th>Hash<th>4909db36f71106379832c8ca57ba5be8<tbody><tr><td>文件类型<td>Word文档<tr><td>文件大小<td>18.7 KB (19,156 字节)<tr><td>文件名<td>ControlsEngineer.docx</table><p class="line" data-line="23">样本文档打开后的内容：<p class="text-center line" data-line="25"><img src="/uploads/2017/07/14/5363525ce39a4ace6e4f0875ceffee76.png" alt="6c8a72617d96b81807073c626e4ba1cd" width="90%"><p class="line" data-line="28">实际上样本文档是一个正常的Word文档，并未利用任何漏洞，文档内容大概是一份电器工程师简历介绍，根据描述的技能判断应该是制造业一类，这和外媒报道的被攻击目标是吻合的。<p class="line" data-line="30">与普通文档不同之处在于，文档内部插入了一个Office模板文档的外部链接：<p class="text-center line" data-line="32"><img src="/uploads/2017/07/14/3a4274a8acb019276c350fe53da2b6e5.png" alt="77cee6e78b3e6d2d1176d13369f7efa1" width="90%"><p class="line" data-line="35">由于该链接失效，正如思科Talos所述，并不知道攻击者通过模板注入的方式对目标实施的具体攻击，但是通过我们的分析总结，归纳出通过模板注入的方式可能进行的攻击有如下三种：<h3 class="line" data-line="37">窃取SMB会话中的NTML HASH</h3><p class="line" data-line="39">通过分析发现，Office文档在处理模板文件外部链接：<code>[*file://IP/Template.dotm*](file://IP/Template.dotm)</code>的时候会尝试对目标服务器先后进行两种方式的访问：<ol><li><p>尝试访问服务器的共享文件：<code>*\\\\IP\\Template.dotm*</code><li><p>如果共享文件访问不成功，则继续访问该服务器的WEBDAV服务：<code>*file://IP/Template.dotm*</code></ol><blockquote><p>访问共享文件的过程如下：</blockquote><p class="line" data-line="47">首先会触发对<code>5.153.58.45</code>这个IP地址的共享文件访问，如果该IP地址开启了共享文件服务，根据Windows访问共享文件夹的机制，本机会使用本地登录的用户密码尝试对SMB服务器进行登录验证，这样攻击者的SMB服务器就可以截获到被攻击者的NTLM HASH等信息（以及用户名、域信息等），进而可以暴力破解用户密码或者进行SMB Relay攻击，经过测试可以在SMB服务端抓取受害者的NTLM HASH：<p class="text-center line" data-line="49"><img src="/uploads/2017/07/14/fe1739d319ea1f45a64f9260cb2638f9.png" alt="684e84611c6b4b01882d063a2052b405" width="90%"><h3 class="line" data-line="52">HTTP Authorization 骗取账号密码</h3><p class="line" data-line="54">如果上一步访问模板文件所在服务器的共享文件不成功，那么会继续尝试访问其WEBDAV服务：<p class="text-center line" data-line="56"><img src="/uploads/2017/07/14/cdb5d0a8943907e8ffb969182f44d60b.png" alt="efbae5daef23e0d162e1d9e56d876f11" width="90%"><p class="line" data-line="59">此时如果服务器配置了HTTP Auth，那么服务器可以返回401页面给客户端，客户端在收到401页面之后，会弹出一个对话框让用户输入帐号密码，并在用户点确认的时候再次发出请求，请求里将带上Authorization header，header内则包含base64编码后的用户名密码：<ul><li>服务器返回401</ul><p class="text-center line" data-line="63"><img src="/uploads/2017/07/14/7aa67d046f5322d3ed80ecfac73071c0.png" alt="216ec3451e9f645abe50081ace94c317" width="90%"><ul><li>客户端弹出标准用户名密码框</ul><p class="text-center line" data-line="68"><img src="/uploads/2017/07/14/d6015b1615d2ff97a45c754054009112.png" alt="2b78b9a736c8f1554b9a5a0b47497b55" width="90%"><ul><li>服务端收到用户输入的用户名密码（base64编码）</ul><p class="text-center line" data-line="73"><img src="/uploads/2017/07/14/d51bee180104f3eae61c6fb657fdd445.png" alt="06fc305ed2e56f5e19cac7d0312a5ed1" width="90%"><blockquote><p>Base64编码后的用户名/密码：YWRtaW5pc3RyYXRvcjp0ZXN0MTIz<p>用户输入的原始用户名/密码：administrator:test123</blockquote><ul><li>需要注意的是Office 2010以后只允许通过SSL进行HTTP访问，所以攻击者的服务器需要搭建HTTPS服务；</ul><h3 class="line" data-line="82">模板注入其它Office漏洞</h3><p class="line" data-line="84">如果将远程加载的模板文档（<code>.dot</code>，<code>.dotm</code>等）替换为可以使用模板文档格式进行攻击的漏洞文档（经过测试<code>CVE-2017-0199</code>可以通过模板注入进行攻击），那么还可以将攻击载体和攻击负载分离，这样隐蔽性更高，配合鱼叉邮件的投递可以使得邮件附件躲过邮件服务器杀软的查杀！<p class="line" data-line="86">经过测试，这种攻击方式也非常实用，下面是插入<code>CVE-2017-0199</code>漏洞进行模板注入攻击的实例：<p class="text-center line" data-line="88"><img src="/uploads/2017/07/14/dbe797678f9a2a25a9534623b3d88658.png" alt="043c7f2868b88787c7fd6dfb161904b0" width="90%"><p class="line" data-line="91">我们将免杀后的模板注入攻击文档提交到VirusTotal上查看，竟然没有一个杀软可以查杀：<p class="text-center line" data-line="93"><img src="/uploads/2017/07/14/38c9cde2d128a04d32b4f66932eaa24a.png" alt="ff4dd762dc24f28638d07fc85ccf12a9" width="90%"><h2 class="line" data-line="96">一个模板同时进行三种攻击</h2><p class="line" data-line="99">经过360天眼实验室的研究发现，通过这种模板攻击方式，可以使用一个攻击向量“同时”进行三种方式的攻击，其主要原理是：<ol><li><p>Office解析外链模板路径file://会先尝试SMB访问，此时攻击者可以先抓取受害者的NTLM HASH，并拒绝访问；<li><p>紧接着Office会进行HTTP访问，此时攻击者返回401错误，受害者的Office弹出用户名/密码框要求用户输入。而在之前的邮件提示等信息中诱导受害者在这个步骤中输入本机用户名/密码并记录，且在服务器端对受害者输入的任意用户名密码都通过验证，以便受害者进入到攻击的第3步；<li><p>通过用户名密码验证后，受害者将从服务器下载执行带有漏洞的模板文件（比如<code>CVE-2017-0199</code>），受害者本地Office解析漏洞模板后触发最后一轮攻击；</ol><blockquote><p>这样，理论上可以同时获取受害者的NTLM HASH、骗取的用户名密码、执行其它漏洞文档。</blockquote><h2 class="line" data-line="109">扩展与关联分析</h2><p class="line" data-line="112">基于360威胁情报中心的数据，以下热力图显示了今年以来使用网上一些公开的<code>Template Injection</code>攻击工具生成的样本量的情况：<p class="text-center line" data-line="114"><img src="/uploads/2017/07/14/d0520819841255e1b38e44519c7a75b9.png" alt="92424d76e6dfd8086e86e3b5a9c05635" width="90%"><p class="line" data-line="117">可以看到此类使用已知工具生成的攻击样本数量正在呈上升趋势！并且值得注意的是，这类样本稍作修改就可以躲过所有杀软的查杀，所以实际使用<code>Template Injection</code>进行攻击的样本数量无法估计。<p class="line" data-line="119">我们选取热力图中最早发现的3月14日的一个样本进行分析发现，该文档也是一份电器工程师简历文档，并且插入的模板链接方式、ID值都和本次攻击完全一致，有较大嫌疑可以认为和本次的攻击事件有关联：<p class="text-center line" data-line="121"><img src="/uploads/2017/07/14/59faac831c553a54fcca2912e82fe440.png" alt="2f58db9cc42e6251a5e821bfa4293189" width="90%"><p class="text-center line" data-line="124"><img src="/uploads/2017/07/14/95205d6dbe9b0da094bdd6918501198c.png" alt="e46574d0ffa1b04b9ffbfda2c9ddf483" width="90%"><p class="line" data-line="128">另外，VirusTotal上提交的一封带有模板注入攻击附件的邮件也证明了此次攻击的目标是美国能源相关的公司（www.integrysgroup.com）：<p class="text-center line" data-line="130"><img src="/uploads/2017/07/14/e8205ec080aa0dce13d8f8d788b93aa7.png" alt="336ed507eaeb9b6f7686c98659e86aee" width="90%"><h2 class="line" data-line="132">思考</h2><ul><li><p>本次外媒报道的模板注入攻击事件，由于当前互联网环境基本不允许访问445端口，所以360天眼实验室认为该攻击的目的不会是获取用户账户凭据，而更可能是骗取用户账号/密码，或者模板注入其它Office漏洞；<li><p>模板注入的攻击技巧其实由来已久（至少10多年前即在网络战中出现），但通过本次事件可以看出当前企业安全防护并没有想象中安全；<li><p>通过模板注入理论上可以绕过所有杀软对攻击载体的查杀，对于这种老树开新花的攻击技巧应该引起一定的重视；</ul><h2 class="line" data-line="141">参考链接</h2><p class="line" style="font-size:12px" data-line="144"><a href="http://blog.talosintelligence.com/2017/07/template-injection.html"><em>http://blog.talosintelligence.com/2017/07/template-injection.html</em></a><p class="line" style="font-size:12px" data-line="146"><a href="http://mp.weixin.qq.com/s/fCg70lBTi-dWQN9zAL97yA"><em>http://mp.weixin.qq.com/s/fCg70lBTi-dWQN9zAL97yA</em></a><p class="line" style="font-size:12px" data-line="148"><a href="http://davenport.sourceforge.net/ntlm.html"><em>http://davenport.sourceforge.net/ntlm.html</em></a></div><div class="back-top" data-v-8db87e62></div></div></section></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{articleData:{_id:"5968a01f5704074e282bcdde",title:"Template Injection 攻击事件: 隐藏在模板文件后的威胁",category:"专题报告",readableId:"Template_Injection_Attack_Behind_Template_Threat",abstract:"《纽约时报》和彭博社上周透露，联邦调查局和国土安全部发布了一份联合报告称：美国的制造工厂、核电站和其他能源设施正遭受网络攻击的威胁。此次袭击至少攻击了美国十几家电力公司，包括在堪萨斯州的 Wolf Creek核设施。\n随后，思科Talos情报和研究小组称，最近攻击者在针对美国能源设施和其他重要基础设施组织的攻击中使用了一种叫做模板注入（Template Injection）的技术。\n360天眼实验室针对此次事件中使用到的恶意样本进行了一些技术分析，详细分析了Template Injection所有可能用到的攻击技术，并且通过关联分析追溯到此次攻击最早可能发生在今年3月。",author:"白皓文",headImg:"/uploads/2017/08/21/7629b381ad00c3915fce41e4bb71b0cc.png",descImg:"/uploads/2017/08/01/045f27711e5726f442f4f4f6e4c20244.png",tags:["docx","template injection","Office"],publish_time:"2017-07-14T10:42:39.115Z",content:'<h2 class="line" data-line="0">事件背景</h2>\n<p class="line" data-line="3">《纽约时报》和彭博社上周透露，联邦调查局和国土安全部发布了一份联合报告称：美国的制造工厂、核电站和其他能源设施正遭受网络攻击的威胁。此次袭击至少攻击了美国十几家电力公司，包括在堪萨斯州的 Wolf Creek核设施。</p>\n<p class="line" data-line="5">随后，思科Talos情报和研究小组称，最近攻击者在针对美国能源设施和其他重要基础设施组织的攻击中使用了一种叫做模板注入（<code>Template Injection</code>）的技术。</p>\n<p class="line" data-line="7">360天眼实验室针对此次事件中使用到的恶意样本进行了一些技术分析，详细分析了<code>Template Injection</code>所有可能用到的攻击技术，并且通过关联分析追溯到此次攻击最早可能发生在今年3月。</p>\n<h2 class="line" data-line="9">Office文档模板</h2>\n<p class="line" data-line="12">Office文档模板是Office文档制作和编辑中重要的一个部分，生成文档模板能够很快的按照固定模板进行设置，直接快速的进行文档处理，Office可以引用本地或者网络上的模板文档。此类文件的后缀一般为<code>.dot</code>、<code>.dotx</code>、<code>.dotm</code>等。</p>\n<h2 class="line" data-line="14">样本分析</h2>\n<table>\n<thead>\n<tr>\n<th>Hash</th>\n<th>4909db36f71106379832c8ca57ba5be8</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>文件类型</td>\n<td>Word文档</td>\n</tr>\n<tr>\n<td>文件大小</td>\n<td>18.7 KB (19,156 字节)</td>\n</tr>\n<tr>\n<td>文件名</td>\n<td>ControlsEngineer.docx</td>\n</tr>\n</tbody>\n</table>\n<p class="line" data-line="23">样本文档打开后的内容：</p>\n<p class="text-center line" data-line="25"><img src="/uploads/2017/07/14/5363525ce39a4ace6e4f0875ceffee76.png" alt="6c8a72617d96b81807073c626e4ba1cd" width="90%"></p>\n<p class="line" data-line="28">实际上样本文档是一个正常的Word文档，并未利用任何漏洞，文档内容大概是一份电器工程师简历介绍，根据描述的技能判断应该是制造业一类，这和外媒报道的被攻击目标是吻合的。</p>\n<p class="line" data-line="30">与普通文档不同之处在于，文档内部插入了一个Office模板文档的外部链接：</p>\n<p class="text-center line" data-line="32"><img src="/uploads/2017/07/14/3a4274a8acb019276c350fe53da2b6e5.png" alt="77cee6e78b3e6d2d1176d13369f7efa1" width="90%"></p>\n<p class="line" data-line="35">由于该链接失效，正如思科Talos所述，并不知道攻击者通过模板注入的方式对目标实施的具体攻击，但是通过我们的分析总结，归纳出通过模板注入的方式可能进行的攻击有如下三种：</p>\n<h3 class="line" data-line="37">窃取SMB会话中的NTML HASH</h3>\n<p class="line" data-line="39">通过分析发现，Office文档在处理模板文件外部链接：<code>[*file://IP/Template.dotm*](file://IP/Template.dotm)</code>的时候会尝试对目标服务器先后进行两种方式的访问：</p>\n<ol>\n<li>\n<p>尝试访问服务器的共享文件：<code>*\\\\\\\\IP\\\\Template.dotm*</code></p>\n</li>\n<li>\n<p>如果共享文件访问不成功，则继续访问该服务器的WEBDAV服务：<code>*file://IP/Template.dotm*</code></p>\n</li>\n</ol>\n<blockquote>\n<p>访问共享文件的过程如下：</p>\n</blockquote>\n<p class="line" data-line="47">首先会触发对<code>5.153.58.45</code>这个IP地址的共享文件访问，如果该IP地址开启了共享文件服务，根据Windows访问共享文件夹的机制，本机会使用本地登录的用户密码尝试对SMB服务器进行登录验证，这样攻击者的SMB服务器就可以截获到被攻击者的NTLM HASH等信息（以及用户名、域信息等），进而可以暴力破解用户密码或者进行SMB Relay攻击，经过测试可以在SMB服务端抓取受害者的NTLM HASH：</p>\n<p class="text-center line" data-line="49"><img src="/uploads/2017/07/14/fe1739d319ea1f45a64f9260cb2638f9.png" alt="684e84611c6b4b01882d063a2052b405" width="90%"></p>\n<h3 class="line" data-line="52">HTTP Authorization 骗取账号密码</h3>\n<p class="line" data-line="54">如果上一步访问模板文件所在服务器的共享文件不成功，那么会继续尝试访问其WEBDAV服务：</p>\n<p class="text-center line" data-line="56"><img src="/uploads/2017/07/14/cdb5d0a8943907e8ffb969182f44d60b.png" alt="efbae5daef23e0d162e1d9e56d876f11" width="90%"></p>\n<p class="line" data-line="59">此时如果服务器配置了HTTP Auth，那么服务器可以返回401页面给客户端，客户端在收到401页面之后，会弹出一个对话框让用户输入帐号密码，并在用户点确认的时候再次发出请求，请求里将带上Authorization header，header内则包含base64编码后的用户名密码：</p>\n<ul>\n<li>服务器返回401</li>\n</ul>\n<p class="text-center line" data-line="63"><img src="/uploads/2017/07/14/7aa67d046f5322d3ed80ecfac73071c0.png" alt="216ec3451e9f645abe50081ace94c317" width="90%"></p>\n<ul>\n<li>客户端弹出标准用户名密码框</li>\n</ul>\n<p class="text-center line" data-line="68"><img src="/uploads/2017/07/14/d6015b1615d2ff97a45c754054009112.png" alt="2b78b9a736c8f1554b9a5a0b47497b55" width="90%"></p>\n<ul>\n<li>服务端收到用户输入的用户名密码（base64编码）</li>\n</ul>\n<p class="text-center line" data-line="73"><img src="/uploads/2017/07/14/d51bee180104f3eae61c6fb657fdd445.png" alt="06fc305ed2e56f5e19cac7d0312a5ed1" width="90%"></p>\n<blockquote>\n<p>Base64编码后的用户名/密码：YWRtaW5pc3RyYXRvcjp0ZXN0MTIz</p>\n<p>用户输入的原始用户名/密码：administrator:test123</p>\n</blockquote>\n<ul>\n<li>需要注意的是Office 2010以后只允许通过SSL进行HTTP访问，所以攻击者的服务器需要搭建HTTPS服务；</li>\n</ul>\n<h3 class="line" data-line="82">模板注入其它Office漏洞</h3>\n<p class="line" data-line="84">如果将远程加载的模板文档（<code>.dot</code>，<code>.dotm</code>等）替换为可以使用模板文档格式进行攻击的漏洞文档（经过测试<code>CVE-2017-0199</code>可以通过模板注入进行攻击），那么还可以将攻击载体和攻击负载分离，这样隐蔽性更高，配合鱼叉邮件的投递可以使得邮件附件躲过邮件服务器杀软的查杀！</p>\n<p class="line" data-line="86">经过测试，这种攻击方式也非常实用，下面是插入<code>CVE-2017-0199</code>漏洞进行模板注入攻击的实例：</p>\n<p class="text-center line" data-line="88"><img src="/uploads/2017/07/14/dbe797678f9a2a25a9534623b3d88658.png" alt="043c7f2868b88787c7fd6dfb161904b0" width="90%"></p>\n<p class="line" data-line="91">我们将免杀后的模板注入攻击文档提交到VirusTotal上查看，竟然没有一个杀软可以查杀：</p>\n<p class="text-center line" data-line="93"><img src="/uploads/2017/07/14/38c9cde2d128a04d32b4f66932eaa24a.png" alt="ff4dd762dc24f28638d07fc85ccf12a9" width="90%"></p>\n<h2 class="line" data-line="96">一个模板同时进行三种攻击</h2>\n<p class="line" data-line="99">经过360天眼实验室的研究发现，通过这种模板攻击方式，可以使用一个攻击向量“同时”进行三种方式的攻击，其主要原理是：</p>\n<ol>\n<li>\n<p>Office解析外链模板路径file://会先尝试SMB访问，此时攻击者可以先抓取受害者的NTLM HASH，并拒绝访问；</p>\n</li>\n<li>\n<p>紧接着Office会进行HTTP访问，此时攻击者返回401错误，受害者的Office弹出用户名/密码框要求用户输入。而在之前的邮件提示等信息中诱导受害者在这个步骤中输入本机用户名/密码并记录，且在服务器端对受害者输入的任意用户名密码都通过验证，以便受害者进入到攻击的第3步；</p>\n</li>\n<li>\n<p>通过用户名密码验证后，受害者将从服务器下载执行带有漏洞的模板文件（比如<code>CVE-2017-0199</code>），受害者本地Office解析漏洞模板后触发最后一轮攻击；</p>\n</li>\n</ol>\n<blockquote>\n<p>这样，理论上可以同时获取受害者的NTLM HASH、骗取的用户名密码、执行其它漏洞文档。</p>\n</blockquote>\n<h2 class="line" data-line="109">扩展与关联分析</h2>\n<p class="line" data-line="112">基于360威胁情报中心的数据，以下热力图显示了今年以来使用网上一些公开的<code>Template Injection</code>攻击工具生成的样本量的情况：</p>\n<p class="text-center line" data-line="114"><img src="/uploads/2017/07/14/d0520819841255e1b38e44519c7a75b9.png" alt="92424d76e6dfd8086e86e3b5a9c05635" width="90%"></p>\n<p class="line" data-line="117">可以看到此类使用已知工具生成的攻击样本数量正在呈上升趋势！并且值得注意的是，这类样本稍作修改就可以躲过所有杀软的查杀，所以实际使用<code>Template Injection</code>进行攻击的样本数量无法估计。</p>\n<p class="line" data-line="119">我们选取热力图中最早发现的3月14日的一个样本进行分析发现，该文档也是一份电器工程师简历文档，并且插入的模板链接方式、ID值都和本次攻击完全一致，有较大嫌疑可以认为和本次的攻击事件有关联：</p>\n<p class="text-center line" data-line="121"><img src="/uploads/2017/07/14/59faac831c553a54fcca2912e82fe440.png" alt="2f58db9cc42e6251a5e821bfa4293189" width="90%"></p>\n<p class="text-center line" data-line="124"><img src="/uploads/2017/07/14/95205d6dbe9b0da094bdd6918501198c.png" alt="e46574d0ffa1b04b9ffbfda2c9ddf483" width="90%"></p>\n<p class="line" data-line="128">另外，VirusTotal上提交的一封带有模板注入攻击附件的邮件也证明了此次攻击的目标是美国能源相关的公司（www.integrysgroup.com）：</p>\n<p class="text-center line" data-line="130"><img src="/uploads/2017/07/14/e8205ec080aa0dce13d8f8d788b93aa7.png" alt="336ed507eaeb9b6f7686c98659e86aee" width="90%"></p>\n<h2 class="line" data-line="132">思考</h2>\n<ul>\n<li>\n<p>本次外媒报道的模板注入攻击事件，由于当前互联网环境基本不允许访问445端口，所以360天眼实验室认为该攻击的目的不会是获取用户账户凭据，而更可能是骗取用户账号/密码，或者模板注入其它Office漏洞；</p>\n</li>\n<li>\n<p>模板注入的攻击技巧其实由来已久（至少10多年前即在网络战中出现），但通过本次事件可以看出当前企业安全防护并没有想象中安全；</p>\n</li>\n<li>\n<p>通过模板注入理论上可以绕过所有杀软对攻击载体的查杀，对于这种老树开新花的攻击技巧应该引起一定的重视；</p>\n</li>\n</ul>\n<h2 class="line" data-line="141">参考链接</h2>\n<p style="font-size:12px" class="line" data-line="144"><a href="http://blog.talosintelligence.com/2017/07/template-injection.html"><em>http://blog.talosintelligence.com/2017/07/template-injection.html</em></a></p>\n<p style="font-size:12px" class="line" data-line="146"><a href="http://mp.weixin.qq.com/s/fCg70lBTi-dWQN9zAL97yA"><em>http://mp.weixin.qq.com/s/fCg70lBTi-dWQN9zAL97yA</em></a></p>\n<p style="font-size:12px" class="line" data-line="148"><a href="http://davenport.sourceforge.net/ntlm.html"><em>http://davenport.sourceforge.net/ntlm.html</em></a></p>\n'}}],error:null,state:{pageId:[],tagParam:[],isMainPage:!1,pageNum:[1,2],articleData:{_id:"5968a01f5704074e282bcdde",title:"Template Injection 攻击事件: 隐藏在模板文件后的威胁",category:"专题报告",readableId:"Template_Injection_Attack_Behind_Template_Threat",abstract:"《纽约时报》和彭博社上周透露，联邦调查局和国土安全部发布了一份联合报告称：美国的制造工厂、核电站和其他能源设施正遭受网络攻击的威胁。此次袭击至少攻击了美国十几家电力公司，包括在堪萨斯州的 Wolf Creek核设施。\n随后，思科Talos情报和研究小组称，最近攻击者在针对美国能源设施和其他重要基础设施组织的攻击中使用了一种叫做模板注入（Template Injection）的技术。\n360天眼实验室针对此次事件中使用到的恶意样本进行了一些技术分析，详细分析了Template Injection所有可能用到的攻击技术，并且通过关联分析追溯到此次攻击最早可能发生在今年3月。",author:"白皓文",headImg:"/uploads/2017/08/21/7629b381ad00c3915fce41e4bb71b0cc.png",descImg:"/uploads/2017/08/01/045f27711e5726f442f4f4f6e4c20244.png",tags:["docx","template injection","Office"],publish_time:"2017-07-14T10:42:39.115Z",content:'<h2 class="line" data-line="0">事件背景</h2>\n<p class="line" data-line="3">《纽约时报》和彭博社上周透露，联邦调查局和国土安全部发布了一份联合报告称：美国的制造工厂、核电站和其他能源设施正遭受网络攻击的威胁。此次袭击至少攻击了美国十几家电力公司，包括在堪萨斯州的 Wolf Creek核设施。</p>\n<p class="line" data-line="5">随后，思科Talos情报和研究小组称，最近攻击者在针对美国能源设施和其他重要基础设施组织的攻击中使用了一种叫做模板注入（<code>Template Injection</code>）的技术。</p>\n<p class="line" data-line="7">360天眼实验室针对此次事件中使用到的恶意样本进行了一些技术分析，详细分析了<code>Template Injection</code>所有可能用到的攻击技术，并且通过关联分析追溯到此次攻击最早可能发生在今年3月。</p>\n<h2 class="line" data-line="9">Office文档模板</h2>\n<p class="line" data-line="12">Office文档模板是Office文档制作和编辑中重要的一个部分，生成文档模板能够很快的按照固定模板进行设置，直接快速的进行文档处理，Office可以引用本地或者网络上的模板文档。此类文件的后缀一般为<code>.dot</code>、<code>.dotx</code>、<code>.dotm</code>等。</p>\n<h2 class="line" data-line="14">样本分析</h2>\n<table>\n<thead>\n<tr>\n<th>Hash</th>\n<th>4909db36f71106379832c8ca57ba5be8</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>文件类型</td>\n<td>Word文档</td>\n</tr>\n<tr>\n<td>文件大小</td>\n<td>18.7 KB (19,156 字节)</td>\n</tr>\n<tr>\n<td>文件名</td>\n<td>ControlsEngineer.docx</td>\n</tr>\n</tbody>\n</table>\n<p class="line" data-line="23">样本文档打开后的内容：</p>\n<p class="text-center line" data-line="25"><img src="/uploads/2017/07/14/5363525ce39a4ace6e4f0875ceffee76.png" alt="6c8a72617d96b81807073c626e4ba1cd" width="90%"></p>\n<p class="line" data-line="28">实际上样本文档是一个正常的Word文档，并未利用任何漏洞，文档内容大概是一份电器工程师简历介绍，根据描述的技能判断应该是制造业一类，这和外媒报道的被攻击目标是吻合的。</p>\n<p class="line" data-line="30">与普通文档不同之处在于，文档内部插入了一个Office模板文档的外部链接：</p>\n<p class="text-center line" data-line="32"><img src="/uploads/2017/07/14/3a4274a8acb019276c350fe53da2b6e5.png" alt="77cee6e78b3e6d2d1176d13369f7efa1" width="90%"></p>\n<p class="line" data-line="35">由于该链接失效，正如思科Talos所述，并不知道攻击者通过模板注入的方式对目标实施的具体攻击，但是通过我们的分析总结，归纳出通过模板注入的方式可能进行的攻击有如下三种：</p>\n<h3 class="line" data-line="37">窃取SMB会话中的NTML HASH</h3>\n<p class="line" data-line="39">通过分析发现，Office文档在处理模板文件外部链接：<code>[*file://IP/Template.dotm*](file://IP/Template.dotm)</code>的时候会尝试对目标服务器先后进行两种方式的访问：</p>\n<ol>\n<li>\n<p>尝试访问服务器的共享文件：<code>*\\\\\\\\IP\\\\Template.dotm*</code></p>\n</li>\n<li>\n<p>如果共享文件访问不成功，则继续访问该服务器的WEBDAV服务：<code>*file://IP/Template.dotm*</code></p>\n</li>\n</ol>\n<blockquote>\n<p>访问共享文件的过程如下：</p>\n</blockquote>\n<p class="line" data-line="47">首先会触发对<code>5.153.58.45</code>这个IP地址的共享文件访问，如果该IP地址开启了共享文件服务，根据Windows访问共享文件夹的机制，本机会使用本地登录的用户密码尝试对SMB服务器进行登录验证，这样攻击者的SMB服务器就可以截获到被攻击者的NTLM HASH等信息（以及用户名、域信息等），进而可以暴力破解用户密码或者进行SMB Relay攻击，经过测试可以在SMB服务端抓取受害者的NTLM HASH：</p>\n<p class="text-center line" data-line="49"><img src="/uploads/2017/07/14/fe1739d319ea1f45a64f9260cb2638f9.png" alt="684e84611c6b4b01882d063a2052b405" width="90%"></p>\n<h3 class="line" data-line="52">HTTP Authorization 骗取账号密码</h3>\n<p class="line" data-line="54">如果上一步访问模板文件所在服务器的共享文件不成功，那么会继续尝试访问其WEBDAV服务：</p>\n<p class="text-center line" data-line="56"><img src="/uploads/2017/07/14/cdb5d0a8943907e8ffb969182f44d60b.png" alt="efbae5daef23e0d162e1d9e56d876f11" width="90%"></p>\n<p class="line" data-line="59">此时如果服务器配置了HTTP Auth，那么服务器可以返回401页面给客户端，客户端在收到401页面之后，会弹出一个对话框让用户输入帐号密码，并在用户点确认的时候再次发出请求，请求里将带上Authorization header，header内则包含base64编码后的用户名密码：</p>\n<ul>\n<li>服务器返回401</li>\n</ul>\n<p class="text-center line" data-line="63"><img src="/uploads/2017/07/14/7aa67d046f5322d3ed80ecfac73071c0.png" alt="216ec3451e9f645abe50081ace94c317" width="90%"></p>\n<ul>\n<li>客户端弹出标准用户名密码框</li>\n</ul>\n<p class="text-center line" data-line="68"><img src="/uploads/2017/07/14/d6015b1615d2ff97a45c754054009112.png" alt="2b78b9a736c8f1554b9a5a0b47497b55" width="90%"></p>\n<ul>\n<li>服务端收到用户输入的用户名密码（base64编码）</li>\n</ul>\n<p class="text-center line" data-line="73"><img src="/uploads/2017/07/14/d51bee180104f3eae61c6fb657fdd445.png" alt="06fc305ed2e56f5e19cac7d0312a5ed1" width="90%"></p>\n<blockquote>\n<p>Base64编码后的用户名/密码：YWRtaW5pc3RyYXRvcjp0ZXN0MTIz</p>\n<p>用户输入的原始用户名/密码：administrator:test123</p>\n</blockquote>\n<ul>\n<li>需要注意的是Office 2010以后只允许通过SSL进行HTTP访问，所以攻击者的服务器需要搭建HTTPS服务；</li>\n</ul>\n<h3 class="line" data-line="82">模板注入其它Office漏洞</h3>\n<p class="line" data-line="84">如果将远程加载的模板文档（<code>.dot</code>，<code>.dotm</code>等）替换为可以使用模板文档格式进行攻击的漏洞文档（经过测试<code>CVE-2017-0199</code>可以通过模板注入进行攻击），那么还可以将攻击载体和攻击负载分离，这样隐蔽性更高，配合鱼叉邮件的投递可以使得邮件附件躲过邮件服务器杀软的查杀！</p>\n<p class="line" data-line="86">经过测试，这种攻击方式也非常实用，下面是插入<code>CVE-2017-0199</code>漏洞进行模板注入攻击的实例：</p>\n<p class="text-center line" data-line="88"><img src="/uploads/2017/07/14/dbe797678f9a2a25a9534623b3d88658.png" alt="043c7f2868b88787c7fd6dfb161904b0" width="90%"></p>\n<p class="line" data-line="91">我们将免杀后的模板注入攻击文档提交到VirusTotal上查看，竟然没有一个杀软可以查杀：</p>\n<p class="text-center line" data-line="93"><img src="/uploads/2017/07/14/38c9cde2d128a04d32b4f66932eaa24a.png" alt="ff4dd762dc24f28638d07fc85ccf12a9" width="90%"></p>\n<h2 class="line" data-line="96">一个模板同时进行三种攻击</h2>\n<p class="line" data-line="99">经过360天眼实验室的研究发现，通过这种模板攻击方式，可以使用一个攻击向量“同时”进行三种方式的攻击，其主要原理是：</p>\n<ol>\n<li>\n<p>Office解析外链模板路径file://会先尝试SMB访问，此时攻击者可以先抓取受害者的NTLM HASH，并拒绝访问；</p>\n</li>\n<li>\n<p>紧接着Office会进行HTTP访问，此时攻击者返回401错误，受害者的Office弹出用户名/密码框要求用户输入。而在之前的邮件提示等信息中诱导受害者在这个步骤中输入本机用户名/密码并记录，且在服务器端对受害者输入的任意用户名密码都通过验证，以便受害者进入到攻击的第3步；</p>\n</li>\n<li>\n<p>通过用户名密码验证后，受害者将从服务器下载执行带有漏洞的模板文件（比如<code>CVE-2017-0199</code>），受害者本地Office解析漏洞模板后触发最后一轮攻击；</p>\n</li>\n</ol>\n<blockquote>\n<p>这样，理论上可以同时获取受害者的NTLM HASH、骗取的用户名密码、执行其它漏洞文档。</p>\n</blockquote>\n<h2 class="line" data-line="109">扩展与关联分析</h2>\n<p class="line" data-line="112">基于360威胁情报中心的数据，以下热力图显示了今年以来使用网上一些公开的<code>Template Injection</code>攻击工具生成的样本量的情况：</p>\n<p class="text-center line" data-line="114"><img src="/uploads/2017/07/14/d0520819841255e1b38e44519c7a75b9.png" alt="92424d76e6dfd8086e86e3b5a9c05635" width="90%"></p>\n<p class="line" data-line="117">可以看到此类使用已知工具生成的攻击样本数量正在呈上升趋势！并且值得注意的是，这类样本稍作修改就可以躲过所有杀软的查杀，所以实际使用<code>Template Injection</code>进行攻击的样本数量无法估计。</p>\n<p class="line" data-line="119">我们选取热力图中最早发现的3月14日的一个样本进行分析发现，该文档也是一份电器工程师简历文档，并且插入的模板链接方式、ID值都和本次攻击完全一致，有较大嫌疑可以认为和本次的攻击事件有关联：</p>\n<p class="text-center line" data-line="121"><img src="/uploads/2017/07/14/59faac831c553a54fcca2912e82fe440.png" alt="2f58db9cc42e6251a5e821bfa4293189" width="90%"></p>\n<p class="text-center line" data-line="124"><img src="/uploads/2017/07/14/95205d6dbe9b0da094bdd6918501198c.png" alt="e46574d0ffa1b04b9ffbfda2c9ddf483" width="90%"></p>\n<p class="line" data-line="128">另外，VirusTotal上提交的一封带有模板注入攻击附件的邮件也证明了此次攻击的目标是美国能源相关的公司（www.integrysgroup.com）：</p>\n<p class="text-center line" data-line="130"><img src="/uploads/2017/07/14/e8205ec080aa0dce13d8f8d788b93aa7.png" alt="336ed507eaeb9b6f7686c98659e86aee" width="90%"></p>\n<h2 class="line" data-line="132">思考</h2>\n<ul>\n<li>\n<p>本次外媒报道的模板注入攻击事件，由于当前互联网环境基本不允许访问445端口，所以360天眼实验室认为该攻击的目的不会是获取用户账户凭据，而更可能是骗取用户账号/密码，或者模板注入其它Office漏洞；</p>\n</li>\n<li>\n<p>模板注入的攻击技巧其实由来已久（至少10多年前即在网络战中出现），但通过本次事件可以看出当前企业安全防护并没有想象中安全；</p>\n</li>\n<li>\n<p>通过模板注入理论上可以绕过所有杀软对攻击载体的查杀，对于这种老树开新花的攻击技巧应该引起一定的重视；</p>\n</li>\n</ul>\n<h2 class="line" data-line="141">参考链接</h2>\n<p style="font-size:12px" class="line" data-line="144"><a href="http://blog.talosintelligence.com/2017/07/template-injection.html"><em>http://blog.talosintelligence.com/2017/07/template-injection.html</em></a></p>\n<p style="font-size:12px" class="line" data-line="146"><a href="http://mp.weixin.qq.com/s/fCg70lBTi-dWQN9zAL97yA"><em>http://mp.weixin.qq.com/s/fCg70lBTi-dWQN9zAL97yA</em></a></p>\n<p style="font-size:12px" class="line" data-line="148"><a href="http://davenport.sourceforge.net/ntlm.html"><em>http://davenport.sourceforge.net/ntlm.html</em></a></p>\n'}},serverRendered:!0}</script><script defer src="/_nuxt/manifest.38f62477280dcc27df9e.js"></script><script defer src="/_nuxt/vendor.bundle.45eca4dc7fa9e1bc4361.js"></script><script defer src="/_nuxt/nuxt.bundle.8e9d53f64bed77ebfe81.js"></script>