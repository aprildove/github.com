<!DOCTYPE html><html data-n-head="" data-n-head-ssr><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" content="width=device-width,initial-scale=1" name="viewport"><meta data-n-head="true" content="Nuxt.js project" name="description" data-hid="description"><title data-n-head="true">360威胁情报中心</title><link href="/fav.ico" rel="icon" data-n-head="true" type="image/x-icon"><link href="/_nuxt/manifest.863edfce59f0a00ce608.js" rel="preload" as="script"><link href="/_nuxt/vendor.bundle.21224f443c6ee9ce918d.js" rel="preload" as="script"><link href="/_nuxt/nuxt.bundle.b8b247420f15d35e36d4.js" rel="preload" as="script"><link href="/_nuxt/0.nuxt.bundle.2df9fec90221d3916af4.js" rel="prefetch"><link href="/_nuxt/1.nuxt.bundle.a78c0d1fcdf1a526e7b5.js" rel="prefetch"><link href="/_nuxt/2.nuxt.bundle.f39815f9942bae29e5fd.js" rel="prefetch"><link href="/_nuxt/3.nuxt.bundle.7f40b4df92fe73eb8bcb.js" rel="prefetch"><style data-vue-ssr-id="1cbf7f39:0 198c0e1e:0 034fd8e0:0 ba3a09e0:0 c2ba7178:0 01cb4693:0 69b5e360:0">.progress[data-v-862bdd9c]{position:fixed;top:0;left:0;right:0;height:2px;width:0;-webkit-transition:width .2s,opacity .4s;-o-transition:width .2s,opacity .4s;transition:width .2s,opacity .4s;opacity:1;background-color:#efc14e;z-index:999999}.hljs ::-webkit-scrollbar{width:8px;height:10px;border-radius:2px;background-color:#839496}.hljs ::-webkit-scrollbar-track{background-color:#bebebe}.hljs ::-webkit-scrollbar-thumb,.hljs ::-webkit-scrollbar-track{border-radius:2px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3)}.hljs ::-webkit-scrollbar-thumb{background-color:#789}html{font-family:Source Sans Pro,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;font-size:16px;word-spacing:1px;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-box-sizing:border-box;box-sizing:border-box}body{background-color:rgba(66,66,66,.05)}*,:after,:before{-webkit-box-sizing:border-box;box-sizing:border-box;margin:0;text-decoration:none}a:active,a:hover,a:link,a:visited{color:#0b1802}.main-body h1,.main-body h2,.main-body h3,.main-body h4,.main-body h5,.main-body h6{margin-top:0;margin-bottom:.5rem}.main-body p{margin-top:0;margin-bottom:1rem;font-size:15px;text-indent:25px;word-wrap:break-word}.main-body img{vertical-align:middle;border-style:none;margin:auto 20px auto auto;padding:3px;border-radius:3px;background-color:#e6e6d5;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.15);box-shadow:0 1px 2px rgba(0,0,0,.15);border:1px solid #b9baa6}.main-body .text-center{text-align:center!important}.main-body table{border-collapse:collapse!important;width:100%;max-width:100%;margin:1em 0;background-color:transparent}.main-body table tbody+tbody{border-top:2px solid #e9ecef}.main-body table td,.main-body table th{padding:.5rem;font-size:.95em;text-align:center;border-collapse:collapse}.main-body table tr{border:1px solid #dfe8fe}.main-body table tr:nth-child(odd){background-color:#ecf1fe}.main-body table tr:nth-child(2n){background-color:#fdfdfd}.main-body table td{white-space:normal;word-break:break-all}.main-body code,.main-body kbd,.main-body pre,.main-body samp{font-family:Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace}.nav-bar[data-v-42857612]{height:60px;border-bottom:1px solid #d5d5d5}.nav-bar .ico-favicon[data-v-42857612]{height:28px;margin-top:16px;margin-left:108px;cursor:pointer}.nav-bar .ico-home[data-v-42857612]{display:inline-block;margin:16px;float:right}.disPic .pic[data-v-42857612]{background-color:#faa732;height:480px;width:100%}.article-page[data-v-8db87e62]{margin:0 auto;max-width:1108px;background-size:cover}.article-page .page-header[data-v-8db87e62]{border-bottom:1px solid #efefef}.article-page .page-header .ava img[data-v-8db87e62]{border-radius:50%;height:56px;width:56px;float:left;margin:12px}.article-page .page-header .title[data-v-8db87e62]{font-size:48px;color:#0b1802;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'"}.article-page .page-header .author[data-v-8db87e62]{display:inline-block;color:#979996;font-size:16px;font-family:"Verdana, \5FAE\8F6F\96C5\9ED1, \5B8B\4F53, Geneva, 'sans-serif'";margin:12px 7px 12px 0;line-height:16px}.article-page .page-header .author .ico-time img[data-v-8db87e62]{width:16px;height:16px}.article-page .main-body[data-v-8db87e62]{padding:0 108px;margin:28px auto 168px;background:url(/_nuxt/img/post-entry-bg.98216ca.png) no-repeat -10px 9px}.title-home[data-v-552f8598]{font-family:sans-serif;line-height:32px;font-size:24px;color:#0b1802;cursor:pointer}.title-home[data-v-552f8598]:hover{text-shadow:2px 3px 1px #d0d0d0}.title-detail[data-v-552f8598]{font-size:48px;color:#0b1802;font-family:Arial Rounded MT Bold;margin-top:48px;line-height:64px}@media screen and (min-width:550px) and (max-width:950px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}@media screen and (max-width:550px){.title-home div[data-v-552f8598]{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;white-space:nowrap}}.tags[data-v-53a17526]{height:42px;padding-top:10px}.tag[data-v-53a17526]{background-color:#6aacd8;display:inline-block;height:22px;font-size:13px;color:#fefefe;font-family:sans-serif;padding:2px 6px;margin-right:8px;border-radius:2px}</style><body data-n-head=""><div data-server-rendered="true" id="__nuxt"><div class="progress" data-v-862bdd9c style="width:0%;height:2px;background-color:#3b8070;opacity:0"></div><div><section><div data-v-42857612><div class="nav-bar" data-v-42857612><a href="/" data-v-42857612><img src="/_nuxt/img/blog-icon.f80549d.png" class="ico-favicon" data-v-42857612></a><a href="/" data-v-42857612><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABYklEQVRYR+2Vy1HDMBCGV5sG0oLH3EkHkA78CHUAHdABtMCZyHEHdgnmHo8pIQ1kxcgTh+DRY20fAjPWTaOV/s//PizgyktcWR9mgP/rQLRrlkj0qGuIEN/zOPgaU0+jHIh2zQqJCgGw1KIK4ECI6zwOqqEQgwH64p3gWIhBADbxKRBsgFPOm852m9VDnWABaPHFkQoQsOLk+AQR5HFw8MV7AYaKnwUVVMdFW5hOCCfAaPGfovBCWAEmizMhrACJrCsBcOvLIevckQ4jQCLrJwHwynqcGaQAnrM0fOuH/00ATbn5aO7bMYtUMD/SGCYI1/pg+xCUpgBvG6ayVqaLCuATQJ1bTIC4M8XJNHRqjAboP2wDnQFmByY7kMh9aapwThHqTsnS0PkH9XfBdh+BELt+i3EAQKlYbm5y1xzxAnRDiZDawdStLA1fLveJrH/tkbC0DZ/LeyyAKZPQd3cGmB34BjX7xSHXvTXWAAAAAElFTkSuQmCC" class="ico-home" data-v-42857612></a></div><!----></div><div class="article-page" data-v-8db87e62><div class="page-header" data-v-8db87e62><div class="title-detail" data-v-8db87e62 data-v-552f8598>H-WORM：简单而活跃的远控木马</div><div class="ava" data-v-8db87e62><img src="/_nuxt/img/Avatar.e419573.jpg" data-v-8db87e62></div><div class="tags" data-v-8db87e62 data-v-53a17526><p class="tag" data-v-53a17526>HWORM</div><div class="author lh32" data-v-8db87e62>admin on</div></div><div class="main-body" data-v-8db87e62><h2 class="line" data-line="0">现象</h2><p class="line" data-line="2">人在做，天在看。<p class="line" data-line="4">远控类木马的活动一直是360天眼实验室的关注重点，近期我们的天眼设备发现了如下一组看起来非常眼熟的被访问的链接。URL的模式非常明显：免费动态域名+非知名的端口+“/is-ready” 。<ul><li>http://adolf2013.sytes.net:1183/is-ready<li>http://herohero.no-ip.org:96/is-ready<li>http://micr0s0ftsoft.myftp.org:82/is-ready<li>http://dzhacker15.no-ip.org:100/is-ready<li>http://blackmind.redirectme.net:820/is-ready<li>http://aass.no-ip.biz:83/is-ready<li>http://sidisalim.myvnc.com:1888/is-ready<li>http://spy2010net.zapto.org:83/is-ready<li>http://smoker21.hopto.org:1920/is-ready</ul><p class="line" data-line="16">查询360威胁情报中心，上面提及的这些域名关联到同一个IP地址：204.95.99.31 。<p class="line text-center" data-line="18"><img src="/uploads/2017/07/25/04857b168375c864afae4632c21bb06c.png" alt="" width="90%"><p class="line" data-line="20">而对IP 204.95.99.31查询情报中心的Passive DNS数据，我们可以发现其绑定过大量的恶意域名，从那些域名通过威胁情报中心又能很快关联相应的恶意样本。经过对得到的样本的分析，我们确认其中绝对大部分样本属于H-WORM恶意代码家族，此外还有一些诸如njRAT、 XtremeRAT、njW0rm等使用同一家族通信协议的RAT恶意样本。<p class="line text-center" data-line="22"><img src="/uploads/2017/07/25/4d0745d79253e5ab053bcd6c5346513d.png" alt="" width="90%"><p class="line" data-line="24">从我们对相关样本量的历史监测图来看，H-WORM在国内一直保有一定的活跃度，其实H-WORM是个非常简单的恶意代码，但在我们强大的病毒查杀体系下却能生存一下必定有它的原因，那么我们来了解一下这个叫做H-WORM的恶意程序。<p class="line text-center" data-line="26"><img src="/uploads/2017/07/25/0e65bbb226798ef538cb0284cb45b86a.png" alt="" width="90%"><h2 class="line" data-line="28">H-WORM</h2><p class="line" data-line="30">H-WORM是个ID为Houdini的人写的一款用VBS实现远控蠕虫，能够通过感染U盘传播，出现的时间最早可以追溯到2013年7月。因为其简洁有效的远控功能、非PE脚本易于免杀、便于修改等特性，一直被黑产所青睐而活跃至今。<p class="line text-center" data-line="32"><img src="/uploads/2017/07/25/708ff521e6d29c61b9c2a4932263e2f6.png" alt="" width="90%"><p class="line" data-line="34">2013年7月24日，H-WORM的作者Houdini在某论坛上发布H-WORM的帖子<p class="line" data-line="36">H-WORM样本的主要传播方式有三种：电子邮件附件、恶意链接和被感染的U盘传播，蠕虫式的传播机制会形成大量的感染。 下面为作者公开提供下载的H-WORM控制端截图，下载地址见文后的参考链接：<p class="line text-center" data-line="38"><img src="/uploads/2017/07/25/82abdb75d4d8cc27304f5d1519e00026.png" alt="" width="90%"><h2 class="line" data-line="40">样本分析</h2><p class="line" data-line="42">代码简洁而有效是H-WORM最大的特点。这里我们对选取其中一个H-WORM样本做一下简单分析，看看H-WORM感染受害者计算机后到底做了些什么，普通用户又该怎样采取应对措施。<table><thead><tr><th><th><tbody><tr><td><strong>样本HASH</strong><td>1eb712d4976babf7c8cd0b34015c2701bc5040420e688911e6614b278cc82a42<tr><td><strong>样本名称</strong><td>F:\cwtslatwbl.vbs</table><p class="line" data-line="49">将样本代码简单解密后，得到真正的代码。解密方式为将“81899982838”替换为空格，然后取每个数值对应的ASCII字符即可。<p class="line text-center" data-line="51"><img src="/uploads/2017/07/25/9e1b758c4eaec8de0fa7b7b455c4eadc.png" alt="" width="90%"><p class="line" data-line="53">样本首先通过读取注册表HKEY_LOCAL_MACHINE\software\脚本名 项来判断当前系统是否已经感染，如未感染，则写入该项。然后通过写入注册表项HKCU\Software\microsoft\CurrentVersion\Run和HKLM\Software\microsoft\CurrentVersion\Run来实现开机自启动，并将自身拷贝到temp目录和Startup目录下：<p class="line text-center" data-line="55"><img src="/uploads/2017/07/25/f706673d28290bc00bb8d122ecc5119a.png" alt="" width="90%"><p class="line" data-line="57">接着，进入主循环，H-WORM会不断循环遍历系统驱动器判断是否有可移动磁盘接入，如果有，则将自身拷贝到可移动磁盘内设置文件属性为隐藏、系统文件。同时将除了.lnk文件外的其他文件隐藏，然后创建其快捷方式，快捷方式的参数则设置为用cmd调用自身，然后再打开原始文件以迷惑用户，这是极其常见而又非常有效的通过移动介质进行传播的方式。相关的代码如下：<p class="line text-center" data-line="59"><img src="/uploads/2017/07/25/311c195e1fad5a94de50003e13bc6723.png" alt="" width="90%"><p class="line" data-line="61">之后开始连接远程服务器，通过HTTP请求向服务器发送用户信息，其收集的用户信息包括computername、username、操作系统版本、杀软信息等等。接着开始接收服务器命令，主要功能有文件管理、进程管理、远程shell、执行远程代码等等，值得一提的是样本使用了User-Agent来传递数据：<p class="line text-center" data-line="63"><img src="/uploads/2017/07/25/c535ad61a4dbfbc048327c32fecb128f.png" alt=""><p class="line text-center" data-line="65"><img src="/uploads/2017/07/25/7593c93c91c829f2ed692afa08397ae8.png" alt="" width="90%"><p class="line" data-line="67">接收命令和对应功能如下图，命令格式为 command &lt;|> param，通过&lt;|>分割命令和参数。<p class="line text-center" data-line="69"><img src="/uploads/2017/07/25/e50775a1f7e8e4406bdcfacef42c09da.png" alt="" width="90%"><p class="line" data-line="71">受害者的计算机感染H-WORM之后，攻击者可以进一步地推送其他恶意程序，使其被彻底控制，或者使其成为僵尸网络的一部分。<h2 class="line" data-line="73">感染情况</h2><p class="line" data-line="75">通过360威胁情报中心的数据，我们估计了最近一个月的H-WORM的感染量，感染的计算机超过6000台。从地域来看，感染影响32个省份和直辖市，其中陕西省和吉林省的受害者最多，占总数的10%和9%；其次是河南、天津，比例均超过7%；然后是四川、广东、江苏、福建、山东、云南等，占比也超过5%。这个分布状态与我们通常看到的与省份的发达程度成正比的恶意代码感染量并不一致，背后的原因也许值得挖掘。<p class="line text-center" data-line="77"><img src="/uploads/2017/07/25/f1adeb56753df20fe59dc6b69f1038cf.png" alt="" width="90%"><h2 class="line" data-line="79">IOC</h2><p class="line" data-line="81">我们统计到的H-WORM样本涉及的C&C地址共有173个，其中有126个域名可以观察到历史解析信息，截至最近抽样统计总共解析接近1000万次。<p class="line" data-line="83">下表为目前比较活跃的其中50个域名，可以作为非常有效的IOC使用。全部已知的域名作为威胁情报已经推送到天眼设备，在部署了设备的网络可以快速发现被感染的系统。<table><thead><tr><th><strong>域名</strong><tbody><tr><td>zzzch.zapto.org<tr><td>ysf.no.ip.biz<tr><td>ycemufkk6g.bounceme.net<tr><td>xxx.xxx.no.ip.info<tr><td>xkiller.no.ip.info<tr><td>wach.no.ip.org<tr><td>tariqalr.zapto.org<tr><td>shagagy21.no.ip.biz<tr><td>sexcam.3utilities.com<tr><td>servecounterstrike.servecounterstrike.com<tr><td>playgame.servecounterstrike.com<tr><td>p.dark.zapto.org<tr><td>nouna1985.no.ip.org<tr><td>n0it.no.ip.org<tr><td>mzab47.myq.see.com<tr><td>modox.no.ip.org<tr><td>mmoohhaammeedd.no.ip.biz<tr><td>mlcrosoft.serveftp.com<tr><td>microsoftupgrades.servehttp.com<tr><td>microsoftsystem.sytes.net<tr><td>micr0s0ftsoft.myftp.org<tr><td>mda.no.ip.org<tr><td>maroco.redirectme.net<tr><td>maroco.myq.see.com<tr><td>maroco.linkpc.net<tr><td>man2010.no.ip.org<tr><td>korom.zapto.org<tr><td>koko.myftp.org<tr><td>klonkino.no.ip.org<tr><td>king.servemp3.com<tr><td>herohero.no.ip.org<tr><td>hacker20133.no.ip.org<tr><td>googlechrome.servequake.com<tr><td>g00gle.sytes.net<tr><td>dzhacker15.no.ip.org<tr><td>dz47.servehttp.com<tr><td>dz47.myq.see.com<tr><td>dz47.linkpc.net<tr><td>dream7.no.ip.biz<tr><td>diiimaria.zapto.org<tr><td>desha10.no.ip.org<tr><td>dataday3.no.ip.org<tr><td>darkanony0501.no.ip.biz<tr><td>cupidon.zapto.org<tr><td>chrom.no.ip.info<tr><td>bog5151.zapto.org<tr><td>blackmind.redirectme.net<tr><td>albertino.no.ip.info<tr><td>adolf2013.sytes.net<tr><td>adamdam.zapto.org</table><h2 class="line" data-line="138">参考链接</h2><p class="line" data-line="140"><a href="http://www.ic0de.org/archive/index.php/t-12134.html">http://www.ic0de.org/archive/index.php/t-12134.html</a><p class="line" data-line="142"><a href="http://rghost.net/47560191">http://rghost.net/47560191</a><p class="line" data-line="144"><a href="https://www.fireeye.com/blog/threat-research/2013/08/njw0rm-brother-from-the-same-mother.html">https://www.fireeye.com/blog/threat-research/2013/08/njw0rm-brother-from-the-same-mother.html</a></div></div></section></div></div><script type="text/javascript">window.__NUXT__={layout:"default",data:[{articleData:{_id:"597733a71c670a09e493ee39",title:"H-WORM：简单而活跃的远控木马",author:"admin",content:'<h2 class="line" data-line="0">现象</h2>\n<p class="line" data-line="2">人在做，天在看。</p>\n<p class="line" data-line="4">远控类木马的活动一直是360天眼实验室的关注重点，近期我们的天眼设备发现了如下一组看起来非常眼熟的被访问的链接。URL的模式非常明显：免费动态域名+非知名的端口+“/is-ready” 。</p>\n<ul>\n<li>http://adolf2013.sytes.net:1183/is-ready</li>\n<li>http://herohero.no-ip.org:96/is-ready</li>\n<li>http://micr0s0ftsoft.myftp.org:82/is-ready</li>\n<li>http://dzhacker15.no-ip.org:100/is-ready</li>\n<li>http://blackmind.redirectme.net:820/is-ready</li>\n<li>http://aass.no-ip.biz:83/is-ready</li>\n<li>http://sidisalim.myvnc.com:1888/is-ready</li>\n<li>http://spy2010net.zapto.org:83/is-ready</li>\n<li>http://smoker21.hopto.org:1920/is-ready</li>\n</ul>\n<p class="line" data-line="16">查询360威胁情报中心，上面提及的这些域名关联到同一个IP地址：204.95.99.31 。</p>\n<p class="text-center line" data-line="18"><img src="/uploads/2017/07/25/04857b168375c864afae4632c21bb06c.png" alt="" width="90%"></p>\n<p class="line" data-line="20">而对IP 204.95.99.31查询情报中心的Passive DNS数据，我们可以发现其绑定过大量的恶意域名，从那些域名通过威胁情报中心又能很快关联相应的恶意样本。经过对得到的样本的分析，我们确认其中绝对大部分样本属于H-WORM恶意代码家族，此外还有一些诸如njRAT、 XtremeRAT、njW0rm等使用同一家族通信协议的RAT恶意样本。</p>\n<p class="text-center line" data-line="22"><img src="/uploads/2017/07/25/4d0745d79253e5ab053bcd6c5346513d.png" alt="" width="90%"></p>\n<p class="line" data-line="24">从我们对相关样本量的历史监测图来看，H-WORM在国内一直保有一定的活跃度，其实H-WORM是个非常简单的恶意代码，但在我们强大的病毒查杀体系下却能生存一下必定有它的原因，那么我们来了解一下这个叫做H-WORM的恶意程序。</p>\n<p class="text-center line" data-line="26"><img src="/uploads/2017/07/25/0e65bbb226798ef538cb0284cb45b86a.png" alt="" width="90%"></p>\n<h2 class="line" data-line="28">H-WORM</h2>\n<p class="line" data-line="30">H-WORM是个ID为Houdini的人写的一款用VBS实现远控蠕虫，能够通过感染U盘传播，出现的时间最早可以追溯到2013年7月。因为其简洁有效的远控功能、非PE脚本易于免杀、便于修改等特性，一直被黑产所青睐而活跃至今。</p>\n<p class="text-center line" data-line="32"><img src="/uploads/2017/07/25/708ff521e6d29c61b9c2a4932263e2f6.png" alt="" width="90%"></p>\n<p class="line" data-line="34">2013年7月24日，H-WORM的作者Houdini在某论坛上发布H-WORM的帖子</p>\n<p class="line" data-line="36">H-WORM样本的主要传播方式有三种：电子邮件附件、恶意链接和被感染的U盘传播，蠕虫式的传播机制会形成大量的感染。 下面为作者公开提供下载的H-WORM控制端截图，下载地址见文后的参考链接：</p>\n<p class="text-center line" data-line="38"><img src="/uploads/2017/07/25/82abdb75d4d8cc27304f5d1519e00026.png" alt="" width="90%"></p>\n<h2 class="line" data-line="40">样本分析</h2>\n<p class="line" data-line="42">代码简洁而有效是H-WORM最大的特点。这里我们对选取其中一个H-WORM样本做一下简单分析，看看H-WORM感染受害者计算机后到底做了些什么，普通用户又该怎样采取应对措施。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>样本HASH</strong></td>\n<td>1eb712d4976babf7c8cd0b34015c2701bc5040420e688911e6614b278cc82a42</td>\n</tr>\n<tr>\n<td><strong>样本名称</strong></td>\n<td>F:\\cwtslatwbl.vbs</td>\n</tr>\n</tbody>\n</table>\n<p class="line" data-line="49">将样本代码简单解密后，得到真正的代码。解密方式为将“81899982838”替换为空格，然后取每个数值对应的ASCII字符即可。</p>\n<p class="text-center line" data-line="51"><img src="/uploads/2017/07/25/9e1b758c4eaec8de0fa7b7b455c4eadc.png" alt="" width="90%"></p>\n<p class="line" data-line="53">样本首先通过读取注册表HKEY_LOCAL_MACHINE\\software\\脚本名  项来判断当前系统是否已经感染，如未感染，则写入该项。然后通过写入注册表项HKCU\\Software\\microsoft\\CurrentVersion\\Run和HKLM\\Software\\microsoft\\CurrentVersion\\Run来实现开机自启动，并将自身拷贝到temp目录和Startup目录下：</p>\n<p class="text-center line" data-line="55"><img src="/uploads/2017/07/25/f706673d28290bc00bb8d122ecc5119a.png" alt="" width="90%"></p>\n<p class="line" data-line="57">接着，进入主循环，H-WORM会不断循环遍历系统驱动器判断是否有可移动磁盘接入，如果有，则将自身拷贝到可移动磁盘内设置文件属性为隐藏、系统文件。同时将除了.lnk文件外的其他文件隐藏，然后创建其快捷方式，快捷方式的参数则设置为用cmd调用自身，然后再打开原始文件以迷惑用户，这是极其常见而又非常有效的通过移动介质进行传播的方式。相关的代码如下：</p>\n<p class="text-center line" data-line="59"><img src="/uploads/2017/07/25/311c195e1fad5a94de50003e13bc6723.png" alt="" width="90%"></p>\n<p class="line" data-line="61">之后开始连接远程服务器，通过HTTP请求向服务器发送用户信息，其收集的用户信息包括computername、username、操作系统版本、杀软信息等等。接着开始接收服务器命令，主要功能有文件管理、进程管理、远程shell、执行远程代码等等，值得一提的是样本使用了User-Agent来传递数据：</p>\n<p class="text-center line" data-line="63"><img src="/uploads/2017/07/25/c535ad61a4dbfbc048327c32fecb128f.png" alt=""></p>\n<p class="text-center line" data-line="65"><img src="/uploads/2017/07/25/7593c93c91c829f2ed692afa08397ae8.png" alt="" width="90%"></p>\n<p class="line" data-line="67">接收命令和对应功能如下图，命令格式为 command &lt;|&gt; param，通过&lt;|&gt;分割命令和参数。</p>\n<p class="text-center line" data-line="69"><img src="/uploads/2017/07/25/e50775a1f7e8e4406bdcfacef42c09da.png" alt="" width="90%"></p>\n<p class="line" data-line="71">受害者的计算机感染H-WORM之后，攻击者可以进一步地推送其他恶意程序，使其被彻底控制，或者使其成为僵尸网络的一部分。</p>\n<h2 class="line" data-line="73">感染情况</h2>\n<p class="line" data-line="75">通过360威胁情报中心的数据，我们估计了最近一个月的H-WORM的感染量，感染的计算机超过6000台。从地域来看，感染影响32个省份和直辖市，其中陕西省和吉林省的受害者最多，占总数的10%和9%；其次是河南、天津，比例均超过7%；然后是四川、广东、江苏、福建、山东、云南等，占比也超过5%。这个分布状态与我们通常看到的与省份的发达程度成正比的恶意代码感染量并不一致，背后的原因也许值得挖掘。</p>\n<p class="text-center line" data-line="77"><img src="/uploads/2017/07/25/f1adeb56753df20fe59dc6b69f1038cf.png" alt="" width="90%"></p>\n<h2 class="line" data-line="79">IOC</h2>\n<p class="line" data-line="81">我们统计到的H-WORM样本涉及的C&amp;C地址共有173个，其中有126个域名可以观察到历史解析信息，截至最近抽样统计总共解析接近1000万次。</p>\n<p class="line" data-line="83">下表为目前比较活跃的其中50个域名，可以作为非常有效的IOC使用。全部已知的域名作为威胁情报已经推送到天眼设备，在部署了设备的网络可以快速发现被感染的系统。</p>\n<table>\n<thead>\n<tr>\n<th><strong>域名</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>zzzch.zapto.org</td>\n</tr>\n<tr>\n<td>ysf.no.ip.biz</td>\n</tr>\n<tr>\n<td>ycemufkk6g.bounceme.net</td>\n</tr>\n<tr>\n<td>xxx.xxx.no.ip.info</td>\n</tr>\n<tr>\n<td>xkiller.no.ip.info</td>\n</tr>\n<tr>\n<td>wach.no.ip.org</td>\n</tr>\n<tr>\n<td>tariqalr.zapto.org</td>\n</tr>\n<tr>\n<td>shagagy21.no.ip.biz</td>\n</tr>\n<tr>\n<td>sexcam.3utilities.com</td>\n</tr>\n<tr>\n<td>servecounterstrike.servecounterstrike.com</td>\n</tr>\n<tr>\n<td>playgame.servecounterstrike.com</td>\n</tr>\n<tr>\n<td>p.dark.zapto.org</td>\n</tr>\n<tr>\n<td>nouna1985.no.ip.org</td>\n</tr>\n<tr>\n<td>n0it.no.ip.org</td>\n</tr>\n<tr>\n<td>mzab47.myq.see.com</td>\n</tr>\n<tr>\n<td>modox.no.ip.org</td>\n</tr>\n<tr>\n<td>mmoohhaammeedd.no.ip.biz</td>\n</tr>\n<tr>\n<td>mlcrosoft.serveftp.com</td>\n</tr>\n<tr>\n<td>microsoftupgrades.servehttp.com</td>\n</tr>\n<tr>\n<td>microsoftsystem.sytes.net</td>\n</tr>\n<tr>\n<td>micr0s0ftsoft.myftp.org</td>\n</tr>\n<tr>\n<td>mda.no.ip.org</td>\n</tr>\n<tr>\n<td>maroco.redirectme.net</td>\n</tr>\n<tr>\n<td>maroco.myq.see.com</td>\n</tr>\n<tr>\n<td>maroco.linkpc.net</td>\n</tr>\n<tr>\n<td>man2010.no.ip.org</td>\n</tr>\n<tr>\n<td>korom.zapto.org</td>\n</tr>\n<tr>\n<td>koko.myftp.org</td>\n</tr>\n<tr>\n<td>klonkino.no.ip.org</td>\n</tr>\n<tr>\n<td>king.servemp3.com</td>\n</tr>\n<tr>\n<td>herohero.no.ip.org</td>\n</tr>\n<tr>\n<td>hacker20133.no.ip.org</td>\n</tr>\n<tr>\n<td>googlechrome.servequake.com</td>\n</tr>\n<tr>\n<td>g00gle.sytes.net</td>\n</tr>\n<tr>\n<td>dzhacker15.no.ip.org</td>\n</tr>\n<tr>\n<td>dz47.servehttp.com</td>\n</tr>\n<tr>\n<td>dz47.myq.see.com</td>\n</tr>\n<tr>\n<td>dz47.linkpc.net</td>\n</tr>\n<tr>\n<td>dream7.no.ip.biz</td>\n</tr>\n<tr>\n<td>diiimaria.zapto.org</td>\n</tr>\n<tr>\n<td>desha10.no.ip.org</td>\n</tr>\n<tr>\n<td>dataday3.no.ip.org</td>\n</tr>\n<tr>\n<td>darkanony0501.no.ip.biz</td>\n</tr>\n<tr>\n<td>cupidon.zapto.org</td>\n</tr>\n<tr>\n<td>chrom.no.ip.info</td>\n</tr>\n<tr>\n<td>bog5151.zapto.org</td>\n</tr>\n<tr>\n<td>blackmind.redirectme.net</td>\n</tr>\n<tr>\n<td>albertino.no.ip.info</td>\n</tr>\n<tr>\n<td>adolf2013.sytes.net</td>\n</tr>\n<tr>\n<td>adamdam.zapto.org</td>\n</tr>\n</tbody>\n</table>\n<h2 class="line" data-line="138">参考链接</h2>\n<p class="line" data-line="140"><a href="http://www.ic0de.org/archive/index.php/t-12134.html">http://www.ic0de.org/archive/index.php/t-12134.html</a></p>\n<p class="line" data-line="142"><a href="http://rghost.net/47560191">http://rghost.net/47560191</a></p>\n<p class="line" data-line="144"><a href="https://www.fireeye.com/blog/threat-research/2013/08/njw0rm-brother-from-the-same-mother.html">https://www.fireeye.com/blog/threat-research/2013/08/njw0rm-brother-from-the-same-mother.html</a></p>\n',category:"专题报告",__v:1,abstract:"远控类木马的活动一直是360天眼实验室的关注重点，近期我们的天眼设备发现了如下一组看起来非常眼熟的被访问的链接。URL的模式非常明显：免费动态域名+非知名的端口+“/is-ready” 。",modify_time:"2017-08-01T08:20:41.015Z",readableId:"hworm-malware",publish_time:"2016-07-10T12:40:52.000Z",descImg:"/uploads/2017/08/01/d989344e7ac3d3447ca4c4ff74ceb210.png",insert_time:"2017-07-25T12:03:51.300Z",isDraft:!1,tags:["HWorm"]}}],error:null,state:{pageId:[],tagParam:[],isMainPage:!1,pageNum:[1,2],articleData:{_id:"597733a71c670a09e493ee39",title:"H-WORM：简单而活跃的远控木马",author:"admin",content:'<h2 class="line" data-line="0">现象</h2>\n<p class="line" data-line="2">人在做，天在看。</p>\n<p class="line" data-line="4">远控类木马的活动一直是360天眼实验室的关注重点，近期我们的天眼设备发现了如下一组看起来非常眼熟的被访问的链接。URL的模式非常明显：免费动态域名+非知名的端口+“/is-ready” 。</p>\n<ul>\n<li>http://adolf2013.sytes.net:1183/is-ready</li>\n<li>http://herohero.no-ip.org:96/is-ready</li>\n<li>http://micr0s0ftsoft.myftp.org:82/is-ready</li>\n<li>http://dzhacker15.no-ip.org:100/is-ready</li>\n<li>http://blackmind.redirectme.net:820/is-ready</li>\n<li>http://aass.no-ip.biz:83/is-ready</li>\n<li>http://sidisalim.myvnc.com:1888/is-ready</li>\n<li>http://spy2010net.zapto.org:83/is-ready</li>\n<li>http://smoker21.hopto.org:1920/is-ready</li>\n</ul>\n<p class="line" data-line="16">查询360威胁情报中心，上面提及的这些域名关联到同一个IP地址：204.95.99.31 。</p>\n<p class="text-center line" data-line="18"><img src="/uploads/2017/07/25/04857b168375c864afae4632c21bb06c.png" alt="" width="90%"></p>\n<p class="line" data-line="20">而对IP 204.95.99.31查询情报中心的Passive DNS数据，我们可以发现其绑定过大量的恶意域名，从那些域名通过威胁情报中心又能很快关联相应的恶意样本。经过对得到的样本的分析，我们确认其中绝对大部分样本属于H-WORM恶意代码家族，此外还有一些诸如njRAT、 XtremeRAT、njW0rm等使用同一家族通信协议的RAT恶意样本。</p>\n<p class="text-center line" data-line="22"><img src="/uploads/2017/07/25/4d0745d79253e5ab053bcd6c5346513d.png" alt="" width="90%"></p>\n<p class="line" data-line="24">从我们对相关样本量的历史监测图来看，H-WORM在国内一直保有一定的活跃度，其实H-WORM是个非常简单的恶意代码，但在我们强大的病毒查杀体系下却能生存一下必定有它的原因，那么我们来了解一下这个叫做H-WORM的恶意程序。</p>\n<p class="text-center line" data-line="26"><img src="/uploads/2017/07/25/0e65bbb226798ef538cb0284cb45b86a.png" alt="" width="90%"></p>\n<h2 class="line" data-line="28">H-WORM</h2>\n<p class="line" data-line="30">H-WORM是个ID为Houdini的人写的一款用VBS实现远控蠕虫，能够通过感染U盘传播，出现的时间最早可以追溯到2013年7月。因为其简洁有效的远控功能、非PE脚本易于免杀、便于修改等特性，一直被黑产所青睐而活跃至今。</p>\n<p class="text-center line" data-line="32"><img src="/uploads/2017/07/25/708ff521e6d29c61b9c2a4932263e2f6.png" alt="" width="90%"></p>\n<p class="line" data-line="34">2013年7月24日，H-WORM的作者Houdini在某论坛上发布H-WORM的帖子</p>\n<p class="line" data-line="36">H-WORM样本的主要传播方式有三种：电子邮件附件、恶意链接和被感染的U盘传播，蠕虫式的传播机制会形成大量的感染。 下面为作者公开提供下载的H-WORM控制端截图，下载地址见文后的参考链接：</p>\n<p class="text-center line" data-line="38"><img src="/uploads/2017/07/25/82abdb75d4d8cc27304f5d1519e00026.png" alt="" width="90%"></p>\n<h2 class="line" data-line="40">样本分析</h2>\n<p class="line" data-line="42">代码简洁而有效是H-WORM最大的特点。这里我们对选取其中一个H-WORM样本做一下简单分析，看看H-WORM感染受害者计算机后到底做了些什么，普通用户又该怎样采取应对措施。</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>样本HASH</strong></td>\n<td>1eb712d4976babf7c8cd0b34015c2701bc5040420e688911e6614b278cc82a42</td>\n</tr>\n<tr>\n<td><strong>样本名称</strong></td>\n<td>F:\\cwtslatwbl.vbs</td>\n</tr>\n</tbody>\n</table>\n<p class="line" data-line="49">将样本代码简单解密后，得到真正的代码。解密方式为将“81899982838”替换为空格，然后取每个数值对应的ASCII字符即可。</p>\n<p class="text-center line" data-line="51"><img src="/uploads/2017/07/25/9e1b758c4eaec8de0fa7b7b455c4eadc.png" alt="" width="90%"></p>\n<p class="line" data-line="53">样本首先通过读取注册表HKEY_LOCAL_MACHINE\\software\\脚本名  项来判断当前系统是否已经感染，如未感染，则写入该项。然后通过写入注册表项HKCU\\Software\\microsoft\\CurrentVersion\\Run和HKLM\\Software\\microsoft\\CurrentVersion\\Run来实现开机自启动，并将自身拷贝到temp目录和Startup目录下：</p>\n<p class="text-center line" data-line="55"><img src="/uploads/2017/07/25/f706673d28290bc00bb8d122ecc5119a.png" alt="" width="90%"></p>\n<p class="line" data-line="57">接着，进入主循环，H-WORM会不断循环遍历系统驱动器判断是否有可移动磁盘接入，如果有，则将自身拷贝到可移动磁盘内设置文件属性为隐藏、系统文件。同时将除了.lnk文件外的其他文件隐藏，然后创建其快捷方式，快捷方式的参数则设置为用cmd调用自身，然后再打开原始文件以迷惑用户，这是极其常见而又非常有效的通过移动介质进行传播的方式。相关的代码如下：</p>\n<p class="text-center line" data-line="59"><img src="/uploads/2017/07/25/311c195e1fad5a94de50003e13bc6723.png" alt="" width="90%"></p>\n<p class="line" data-line="61">之后开始连接远程服务器，通过HTTP请求向服务器发送用户信息，其收集的用户信息包括computername、username、操作系统版本、杀软信息等等。接着开始接收服务器命令，主要功能有文件管理、进程管理、远程shell、执行远程代码等等，值得一提的是样本使用了User-Agent来传递数据：</p>\n<p class="text-center line" data-line="63"><img src="/uploads/2017/07/25/c535ad61a4dbfbc048327c32fecb128f.png" alt=""></p>\n<p class="text-center line" data-line="65"><img src="/uploads/2017/07/25/7593c93c91c829f2ed692afa08397ae8.png" alt="" width="90%"></p>\n<p class="line" data-line="67">接收命令和对应功能如下图，命令格式为 command &lt;|&gt; param，通过&lt;|&gt;分割命令和参数。</p>\n<p class="text-center line" data-line="69"><img src="/uploads/2017/07/25/e50775a1f7e8e4406bdcfacef42c09da.png" alt="" width="90%"></p>\n<p class="line" data-line="71">受害者的计算机感染H-WORM之后，攻击者可以进一步地推送其他恶意程序，使其被彻底控制，或者使其成为僵尸网络的一部分。</p>\n<h2 class="line" data-line="73">感染情况</h2>\n<p class="line" data-line="75">通过360威胁情报中心的数据，我们估计了最近一个月的H-WORM的感染量，感染的计算机超过6000台。从地域来看，感染影响32个省份和直辖市，其中陕西省和吉林省的受害者最多，占总数的10%和9%；其次是河南、天津，比例均超过7%；然后是四川、广东、江苏、福建、山东、云南等，占比也超过5%。这个分布状态与我们通常看到的与省份的发达程度成正比的恶意代码感染量并不一致，背后的原因也许值得挖掘。</p>\n<p class="text-center line" data-line="77"><img src="/uploads/2017/07/25/f1adeb56753df20fe59dc6b69f1038cf.png" alt="" width="90%"></p>\n<h2 class="line" data-line="79">IOC</h2>\n<p class="line" data-line="81">我们统计到的H-WORM样本涉及的C&amp;C地址共有173个，其中有126个域名可以观察到历史解析信息，截至最近抽样统计总共解析接近1000万次。</p>\n<p class="line" data-line="83">下表为目前比较活跃的其中50个域名，可以作为非常有效的IOC使用。全部已知的域名作为威胁情报已经推送到天眼设备，在部署了设备的网络可以快速发现被感染的系统。</p>\n<table>\n<thead>\n<tr>\n<th><strong>域名</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>zzzch.zapto.org</td>\n</tr>\n<tr>\n<td>ysf.no.ip.biz</td>\n</tr>\n<tr>\n<td>ycemufkk6g.bounceme.net</td>\n</tr>\n<tr>\n<td>xxx.xxx.no.ip.info</td>\n</tr>\n<tr>\n<td>xkiller.no.ip.info</td>\n</tr>\n<tr>\n<td>wach.no.ip.org</td>\n</tr>\n<tr>\n<td>tariqalr.zapto.org</td>\n</tr>\n<tr>\n<td>shagagy21.no.ip.biz</td>\n</tr>\n<tr>\n<td>sexcam.3utilities.com</td>\n</tr>\n<tr>\n<td>servecounterstrike.servecounterstrike.com</td>\n</tr>\n<tr>\n<td>playgame.servecounterstrike.com</td>\n</tr>\n<tr>\n<td>p.dark.zapto.org</td>\n</tr>\n<tr>\n<td>nouna1985.no.ip.org</td>\n</tr>\n<tr>\n<td>n0it.no.ip.org</td>\n</tr>\n<tr>\n<td>mzab47.myq.see.com</td>\n</tr>\n<tr>\n<td>modox.no.ip.org</td>\n</tr>\n<tr>\n<td>mmoohhaammeedd.no.ip.biz</td>\n</tr>\n<tr>\n<td>mlcrosoft.serveftp.com</td>\n</tr>\n<tr>\n<td>microsoftupgrades.servehttp.com</td>\n</tr>\n<tr>\n<td>microsoftsystem.sytes.net</td>\n</tr>\n<tr>\n<td>micr0s0ftsoft.myftp.org</td>\n</tr>\n<tr>\n<td>mda.no.ip.org</td>\n</tr>\n<tr>\n<td>maroco.redirectme.net</td>\n</tr>\n<tr>\n<td>maroco.myq.see.com</td>\n</tr>\n<tr>\n<td>maroco.linkpc.net</td>\n</tr>\n<tr>\n<td>man2010.no.ip.org</td>\n</tr>\n<tr>\n<td>korom.zapto.org</td>\n</tr>\n<tr>\n<td>koko.myftp.org</td>\n</tr>\n<tr>\n<td>klonkino.no.ip.org</td>\n</tr>\n<tr>\n<td>king.servemp3.com</td>\n</tr>\n<tr>\n<td>herohero.no.ip.org</td>\n</tr>\n<tr>\n<td>hacker20133.no.ip.org</td>\n</tr>\n<tr>\n<td>googlechrome.servequake.com</td>\n</tr>\n<tr>\n<td>g00gle.sytes.net</td>\n</tr>\n<tr>\n<td>dzhacker15.no.ip.org</td>\n</tr>\n<tr>\n<td>dz47.servehttp.com</td>\n</tr>\n<tr>\n<td>dz47.myq.see.com</td>\n</tr>\n<tr>\n<td>dz47.linkpc.net</td>\n</tr>\n<tr>\n<td>dream7.no.ip.biz</td>\n</tr>\n<tr>\n<td>diiimaria.zapto.org</td>\n</tr>\n<tr>\n<td>desha10.no.ip.org</td>\n</tr>\n<tr>\n<td>dataday3.no.ip.org</td>\n</tr>\n<tr>\n<td>darkanony0501.no.ip.biz</td>\n</tr>\n<tr>\n<td>cupidon.zapto.org</td>\n</tr>\n<tr>\n<td>chrom.no.ip.info</td>\n</tr>\n<tr>\n<td>bog5151.zapto.org</td>\n</tr>\n<tr>\n<td>blackmind.redirectme.net</td>\n</tr>\n<tr>\n<td>albertino.no.ip.info</td>\n</tr>\n<tr>\n<td>adolf2013.sytes.net</td>\n</tr>\n<tr>\n<td>adamdam.zapto.org</td>\n</tr>\n</tbody>\n</table>\n<h2 class="line" data-line="138">参考链接</h2>\n<p class="line" data-line="140"><a href="http://www.ic0de.org/archive/index.php/t-12134.html">http://www.ic0de.org/archive/index.php/t-12134.html</a></p>\n<p class="line" data-line="142"><a href="http://rghost.net/47560191">http://rghost.net/47560191</a></p>\n<p class="line" data-line="144"><a href="https://www.fireeye.com/blog/threat-research/2013/08/njw0rm-brother-from-the-same-mother.html">https://www.fireeye.com/blog/threat-research/2013/08/njw0rm-brother-from-the-same-mother.html</a></p>\n',category:"专题报告",__v:1,abstract:"远控类木马的活动一直是360天眼实验室的关注重点，近期我们的天眼设备发现了如下一组看起来非常眼熟的被访问的链接。URL的模式非常明显：免费动态域名+非知名的端口+“/is-ready” 。",modify_time:"2017-08-01T08:20:41.015Z",readableId:"hworm-malware",publish_time:"2016-07-10T12:40:52.000Z",descImg:"/uploads/2017/08/01/d989344e7ac3d3447ca4c4ff74ceb210.png",insert_time:"2017-07-25T12:03:51.300Z",isDraft:!1,tags:["HWorm"]}},serverRendered:!0}</script><script defer src="/_nuxt/manifest.863edfce59f0a00ce608.js"></script><script defer src="/_nuxt/vendor.bundle.21224f443c6ee9ce918d.js"></script><script defer src="/_nuxt/nuxt.bundle.b8b247420f15d35e36d4.js"></script>